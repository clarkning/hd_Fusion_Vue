webpackJsonp([39],{PooF:function(e,t){},"Z/lg":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("j1Zw"),r=a.n(i),n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"activation_server bg_img_none"},[a("div",{staticClass:"product"},[a("div",{staticClass:"header"},[e._v("待激活产品")]),e._v(" "),a("div",{staticClass:"item_container"},[a("div",{staticClass:"item_p mt-10"},[a("div",{staticClass:"item_img"},[a("img",{attrs:{src:e.serviceOptionItem.list.fileUrl}})]),e._v(" "),a("div",{staticClass:"item_content"},[a("p",{staticClass:"productName"},[e._v(e._s(e.serviceOptionItem.list.name))]),e._v(" "),a("div",{staticClass:"item_font12 item_color"},[e._v(e._s(e.serviceOptionItem.list.unitPrice)+"元")])])])])]),e._v(" "),a("div",{staticClass:"remarks"},[a("div",{staticClass:"header",attrs:{id:"lift"}},[e._v("用户及设备信息")]),e._v(" "),a("div",{staticClass:"container",on:{click:function(t){e.liftTop()}}},[a("mt-field",{attrs:{label:"姓名",placeholder:"请输入客户姓名",disableClear:!0},model:{value:e.customerName,callback:function(t){e.customerName=t},expression:"customerName"}})],1),e._v(" "),a("div",{staticClass:"container"},[a("mt-field",{attrs:{label:"手机",placeholder:"请输入客户手机号码",type:"tel",disableClear:!0},model:{value:e.phoneNumber,callback:function(t){e.phoneNumber=t},expression:"phoneNumber"}})],1),e._v(" "),a("div",{staticClass:"border_price container",class:{m_t15:e.showOrHide.existPurchaseTime&&!e.showOrHide.isHardwareProducts},attrs:{id:"price"}},[a("mt-field",{attrs:{label:"购机价格:",placeholder:"请输入购机价格",type:"tel"},model:{value:e.purchasePrice,callback:function(t){e.purchasePrice=t},expression:"purchasePrice"}})],1),e._v(" "),a("div",{staticClass:"container black",on:{click:function(t){e.openPicker()}}},[a("mt-field",{attrs:{label:"购机日期:",placeholder:"请选择购机日期",type:"text",id:"dateBlur",disabled:!0,disableClear:!0},model:{value:e.timePicker.viewDate,callback:function(t){e.$set(e.timePicker,"viewDate",t)},expression:"timePicker.viewDate"}})],1),e._v(" "),a("div",{on:{touchmove:function(e){e.preventDefault()}}},[a("mt-datetime-picker",{ref:"picker",staticClass:"timePicker",attrs:{"lock-scroll":"true",type:"date",endDate:e.timePicker.maxDate,"year-format":"{value} "},on:{confirm:e.handleConfirm},model:{value:e.timePicker.pickerValue,callback:function(t){e.$set(e.timePicker,"pickerValue",t)},expression:"timePicker.pickerValue"}})],1),e._v(" "),a("div",[a("div",{staticClass:"container activation_no_float",on:{click:function(t){e.goToPageCategory()}}},[a("div",{staticClass:"container_c",class:{placeholder:e.isCategoryPlaceholder}},[a("div",{staticClass:"content"},[a("mt-cell",{attrs:{title:"品类",value:e.orderFilling.category.value.categoryName}})],1),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.linkFlag,expression:"linkFlag"}],staticClass:"link"})])]),e._v(" "),a("div",{staticClass:"container activation_no_float",on:{click:function(t){e.goToPageBrand()}}},[a("div",{staticClass:"container_c",class:{placeholder:e.isBrandPlaceholder}},[a("div",{staticClass:"content",class:{select:"请选择品牌"===e.orderFilling.brand.value.brandName}},[a("mt-cell",{attrs:{title:"品牌",value:e.orderFilling.brand.value.brandName,placeholder:"请选择品牌"}})],1),e._v(" "),a("span",{staticClass:"link"})])]),e._v(" "),e._l(e.expand.otherExpand,function(t){return a("div",{staticClass:"container"},[5===t.contentTypeCode?a("div",{staticClass:"geography"},[a("div",{staticClass:"container",class:{address:""!==e.address.province.name},on:{click:function(t){e.provincePicker.show=e.expand.showLocation}}},[a("mt-field",{attrs:{label:"省",placeholder:"请选择省",disabled:!0},model:{value:e.address.province.name,callback:function(t){e.$set(e.address.province,"name",t)},expression:"address.province.name"}})],1),e._v(" "),a("mt-popup",{staticClass:"upimg-popup",attrs:{position:"bottom","lock-scroll":"true",closeOnClickModal:!1},model:{value:e.provincePicker.show,callback:function(t){e.$set(e.provincePicker,"show",t)},expression:"provincePicker.show"}},[a("div",{on:{touchmove:function(e){e.preventDefault()}}},[a("div",{staticClass:"popup-top clear_button"},[a("mt-button",{staticClass:"popup-button cancel",attrs:{type:"primary",size:"small"},on:{click:function(t){e.provincePicker.show=!1}}},[e._v("取消\n                ")]),e._v(" "),a("mt-button",{staticClass:"popup-button",attrs:{type:"primary",size:"small"},on:{click:function(t){e.chooseProvince()}}},[e._v("确定")])],1),e._v(" "),a("mt-picker",{ref:"provincePickerObject",refInFor:!0,attrs:{slots:e.provincePicker.slot,"value-key":"name"}})],1)]),e._v(" "),a("div",{staticClass:"container",class:{address:""!==e.address.city.name},on:{click:function(t){e.cityPicker.show=e.expand.showLocation}}},[a("mt-field",{attrs:{label:"市",placeholder:"请选择市",disabled:!0},model:{value:e.address.city.name,callback:function(t){e.$set(e.address.city,"name",t)},expression:"address.city.name"}})],1),e._v(" "),a("mt-popup",{staticClass:"upimg-popup",attrs:{position:"bottom","lock-scroll":"true",closeOnClickModal:!1},model:{value:e.cityPicker.show,callback:function(t){e.$set(e.cityPicker,"show",t)},expression:"cityPicker.show"}},[a("div",{on:{touchmove:function(e){e.preventDefault()}}},[a("div",{staticClass:"popup-top clear_button"},[a("mt-button",{staticClass:"popup-button cancel",attrs:{type:"primary",size:"small"},on:{click:function(t){e.cityPicker.show=!1}}},[e._v("\n                  取消\n                ")]),e._v(" "),a("mt-button",{staticClass:"popup-button",attrs:{type:"primary",size:"small"},on:{click:function(t){e.chooseCity()}}},[e._v("确定")])],1),e._v(" "),a("mt-picker",{ref:"cityPickerObject",refInFor:!0,attrs:{slots:e.cityPicker.slot,"value-key":"name"}})],1)]),e._v(" "),a("div",{staticClass:"container",class:{address:""!==e.address.county.name},on:{click:function(t){e.countyPicker.show=e.expand.showLocation}}},[a("mt-field",{attrs:{label:"县",placeholder:"请选择县",disabled:!0},model:{value:e.address.county.name,callback:function(t){e.$set(e.address.county,"name",t)},expression:"address.county.name"}})],1),e._v(" "),a("mt-popup",{staticClass:"upimg-popup",attrs:{position:"bottom","lock-scroll":"true",closeOnClickModal:!1},model:{value:e.countyPicker.show,callback:function(t){e.$set(e.countyPicker,"show",t)},expression:"countyPicker.show"}},[a("div",{on:{touchmove:function(e){e.preventDefault()}}},[a("div",{staticClass:"popup-top clear_button"},[a("mt-button",{staticClass:"popup-button cancel",attrs:{type:"primary",size:"small"},on:{click:function(t){e.countyPicker.show=!1}}},[e._v("\n                  取消\n                ")]),e._v(" "),a("mt-button",{staticClass:"popup-button",attrs:{type:"primary",size:"small"},on:{click:function(t){e.chooseCounty()}}},[e._v("确定")])],1),e._v(" "),a("mt-picker",{ref:"countyPickerObject",refInFor:!0,attrs:{slots:e.countyPicker.slot,"value-key":"name"}})],1)]),e._v(" "),a("mt-field",{attrs:{readonly:!e.expand.showLocation,label:"详细地址",placeholder:"请输入详细地址",type:"textarea",rows:"2",disableClear:!0},model:{value:e.address.desc,callback:function(t){e.$set(e.address,"desc",t)},expression:"address.desc"}})],1):a("div",[a("mt-field",{attrs:{label:t.name,placeholder:t.describe,disableClear:!0,disabled:!e.remarksFlag},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"item.value"}},[4===t.contentTypeCode?a("span",{staticClass:"scan_icon",on:{click:function(a){e.scanQRCode(t.id)}}},[a("img",{attrs:{src:"/static/we-icon.png"}})]):e._e()])],1)])}),e._v(" "),a("div",{staticClass:"img_container",class:{disabled:!e.remarksFlag}},e._l(e.expand.imageExpand,function(t){return a("div",{staticClass:"pic"},[a("div",{staticClass:"img",on:{click:function(a){e.chooseImage(t.id)}}},[a("img",{directives:[{name:"show",rawName:"v-show",value:t.src,expression:"item.src"}],attrs:{src:t.src}})]),e._v(" "),a("p",{staticClass:"title"},[e._v(e._s(t.name))])])}))],2)]),e._v(" "),a("div",{staticClass:"height_40 height_100",class:{height_100:e.licenceId&&e.remarksFlag}}),e._v(" "),a("div",{staticClass:"fixButton pt_8 footer"},[a("div",{staticClass:"p_r15 clear"},[a("label",{staticClass:"f-l"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.agreeChecked,expression:"agreeChecked"}],staticClass:"pay-radio",attrs:{type:"radio",name:"licence",value:"true",checked:"true"},domProps:{checked:e._q(e.agreeChecked,"true")},on:{click:function(t){e.inputType()},change:function(t){e.agreeChecked="true"}}}),e._v(" "),a("span",{staticClass:"pay-radioInput m-0"})]),e._v(" "),a("span",{staticClass:"agreeClause"},[e._v("本人承诺上述信息的真实性，理解并同意"),a("span",{staticClass:"item_button item_color_02",on:{click:function(t){t.stopPropagation(),e.goToPageLicence()}}},[e._v("《服务条款》")]),e._v("的全部内容")])]),e._v(" "),a("div",{staticClass:"w_90",class:{mt_5:e.licenceId&&e.remarksFlag}},[a("span",{staticClass:"price_buy"},[e._v("￥"+e._s(e.serviceOptionItem.list.unitPrice))]),e._v(" "),a("mt-button",{staticClass:"buttonBuy",attrs:{size:"normal",type:"primary"},on:{click:function(t){e.submitOrder()}}},[e._v("立即激活")])],1)])])},staticRenderFns:[]},s=function(e){a("PooF")},c=a("VU/8")(r.a,n,!1,s,"data-v-d830b664",null);t.default=c.exports},j1Zw:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(a("BO1k")),n=i(a("woOf")),s=i(a("mvHQ")),c=i(a("Xxa5")),o=i(a("exGp")),d=i(a("3D1+")),l=i(a("PJh5")),u=i(a("M4fF")),p=a("JaHG"),h=a("Au9i"),f=i(a("fxnj"));t.default={name:"activateOrderFilling",data:function(){return{projectId:null,storeId:null,activationProduct:"",linkFlag:null,customerName:window.localStorage.getItem("customerName")||"",phoneNumber:window.localStorage.getItem("phoneNumber")||"",loadInfo:!0,licenceId:"",agreeChecked:"",checkValue:{},radioFlag:!1,remarksFlag:!1,showOrHide:{existPurchaseTime:"",isHardwareProducts:!0},params:{servicePackId:null,storeId:null,projectId:null},timePicker:{pickerValue:(0,l.default)().toDate(),viewDate:null,purchaseTime:null,maxDate:(0,l.default)().toDate()},purchasePrice:"",serviceOptionItem:{list:[{name:"",unitPrice:""}],showList:!1},ifSubmit:!0,orderId:null,orderFilling:{category:{value:""}},expand:{submitImage:!1,showLocation:!1,confirm:!1,imageExpand:[],timeExpand:[],otherExpand:[],expands:[]},provincePicker:{value:"",slot:[{flex:1,values:[],className:"province",textAlign:"center"}],show:!1},cityPicker:{value:"",slot:[{flex:1,values:[],className:"city",textAlign:"center"}],show:!1},countyPicker:{value:"",slot:[{flex:1,values:[],className:"county",textAlign:"center"}],show:!1},address:{desc:"",province:{geographyType:0,id:null,name:""},city:{geographyType:1,id:null,name:""},county:{geographyType:2,id:null,name:""}},data:{OrderId:"",BrandId:"",CategoryId:"",CustomerName:"",CustomerPhone:"",ExpandData:[],PurchasePrice:"",Remark:""}}},created:function(){var e=(0,o.default)(c.default.mark(function e(){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.initProduct(),this.params.servicePackId=this.$route.query.servicePackId,this.params.storeId=this.$route.query.storeId,this.params.projectId=this.$route.query.projectId,!window.localStorage.getItem("orderFilling")){e.next=15;break}if(window.localStorage.getItem("memoryFlag")){e.next=9;break}this.initOrder(),e.next=13;break;case 9:return this.loadInfo=!1,e.next=12,this.load();case 12:this.remarksFlag=!0;case 13:e.next=18;break;case 15:return window.localStorage.getItem("memoryFlag")||this.initOrder(),e.next=18,this.load();case 18:this.purchasePrice=this.orderFilling.purchasePrice,this.timePicker.viewDate=this.orderFilling.viewDate,this.timePicker.purchaseTime=this.orderFilling.purchaseTime;case 21:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),mounted:function(){var e=(0,o.default)(c.default.mark(function e(){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.config();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),beforeRouteLeave:function(e,t,a){this.setOrderFilling(),a()},methods:{liftTop:function(){document.getElementById("lift").scrollIntoView()},getDate:function(){var e=new Date,t=e.getMonth()+1,a=e.getDate();t>=1&&t<=9&&(t="0"+t),a>=0&&a<=9&&(a="0"+a),this.orderFilling.purchaseTime=e.getFullYear()+"-"+t+"-"+a},inputType:function(){this.remarksFlag=!0,this.agreeChecked=!0,window.localStorage.setItem("agreeChecked",(0,s.default)(this.agreeChecked))},initProduct:function(){var e=this.$store.state.order.activationProduct;this.serviceOptionItem.list.sku=e.sku,this.serviceOptionItem.list.cardId=e.cardId,this.serviceOptionItem.list.name=e.name,this.serviceOptionItem.list.description=e.description,this.serviceOptionItem.list.servicePackId=e.servicePackId,this.serviceOptionItem.list.unitPrice=e.unitPrice,this.serviceOptionItem.list.fileUrl=e.fileUrl,this.licenceId=e.serviceLensenceId},setOrderFilling:function(){window.localStorage.setItem("memoryFlag",!0);var e={viewDate:this.timePicker.viewDate,purchasePrice:this.purchasePrice,purchaseTime:this.timePicker.purchaseTime},t=!0,a=!1,i=void 0;try{for(var c,o=(0,r.default)(this.expand.expands);!(t=(c=o.next()).done);t=!0){var d=c.value;5===d.contentTypeCode&&(d.value=(0,s.default)({addressDescription:this.address.desc,city:this.address.city.name,cityId:this.address.city.id,county:this.address.county.name,countyId:this.address.county.id,province:this.address.province.name,provinceId:this.address.province.id}))}}catch(e){a=!0,i=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw i}}var l=JSON.parse((0,s.default)(this.orderFilling));(0,n.default)(l,e),l.expand=this.expand.expands,window.localStorage.setItem("orderFilling",(0,s.default)(l))},initOrder:function(){window.localStorage.setItem("orderFilling",(0,s.default)({category:{value:{categoryName:"手机",categoryId:null},categoryList:[],isJumpingCategory:null},brand:{value:{brandName:"请选择品牌",brandId:null},brandList:[],isJumpingBrand:null},expand:[{contentTypeCode:3,describe:"请上传显示IMEI屏幕照片",name:"上传显示IMEI的屏幕照片"},{contentTypeCode:3,describe:"请上传购机发票照片",name:"上传购机发票照片"},{contentTypeCode:0,describe:"请输入手机型号lll",name:"手机型号"},{contentTypeCode:0,describe:"请输入IMEI",name:"IMEI"},{contentTypeCode:0,describe:"请输入发票编号",name:"发票编号"}],service:{serviceItemName:null,unitPrice:null,serviceOptionItemId:null,servicePackId:null},viewDate:null,purchaseTime:null,purchasePrice:""}))},addTitle:function(){if(1!==document.getElementsByClassName("datetime_title").length){document.getElementsByClassName("picker-toolbar")[0].insertAdjacentHTML("beforeBegin",'<div class="datetime_title">请选择购机日期</div>')}},openPicker:function(){document.getElementById("dateBlur").getElementsByTagName("input")[0].blur(),this.getDate(),this.addTitle(),this.timePicker.purchaseTime,this.$refs.picker.open()},setDate:function(e){this.timePicker.viewDate=(0,l.default)(e).format("YYYY 年 MM 月 DD 日"),this.timePicker.purchaseTime=(0,l.default)(e).format("YYYY/MM/DD")},handleConfirm:function(e){this.setDate(e)},goToPageCategory:function(){1!==this.orderFilling.category.categoryList.length&&this.$router.push({name:"hbCategory",query:{sku:JSON.parse((0,s.default)(this.serviceOptionItem.list.sku))}})},goToPageLicence:function(){this.$router.push({name:"Licence",query:{licenceId:this.licenceId}})},load:function(){var e=(0,o.default)(c.default.mark(function e(){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getOrderFillingData();case 2:return e.next=4,this.getCategoryList();case 4:return e.next=6,this.getBrandList();case 6:this.agreeChecked=window.localStorage.getItem("agreeChecked");case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),config:function(){var e=(0,o.default)(c.default.mark(function e(){var t,a;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=location.href.split("#")[0],a=window.localStorage.getItem("agentId"),e.next=4,this.$initWxConfig(t,["chooseImage","getLocalImgData","uploadImage","scanQRCode","getLocation"],a);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getOrderFillingData:function(){var e=(0,o.default)(c.default.mark(function e(){var t,a;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.orderFilling=JSON.parse(window.localStorage.getItem("orderFilling")),this.orderFilling.purchaseTime&&(this.orderFilling.purchaseTime=(0,l.default)(this.orderFilling.purchaseTime).format("YYYY-MM-DD")),this.expand.expands=this.orderFilling.expand,this.expand.otherExpand=this.expand.expands.filter(function(e){return 1!==e.contentTypeCode&&3!==e.contentTypeCode}),this.expand.timeExpand=this.expand.expands.filter(function(e){return 1===e.contentTypeCode}),this.expand.imageExpand=this.expand.expands.filter(function(e){return 3===e.contentTypeCode}),(t=this.expand.expands.filter(function(e){return 5===e.contentTypeCode})).length>0&&t[0].value&&(a=JSON.parse(t[0].value),this.address.desc=a.addressDescription,this.address.city.name=a.city,this.address.city.id=a.cityId,this.address.county.name=a.county,this.address.county.id=a.countyId,this.address.province.name=a.province,this.address.province.id=a.provinceId);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getCategoryList:function(){var e=(0,o.default)(c.default.mark(function e(){var t=this;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loadInfo){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,(0,p.loadData)(function(){return d.default.activateCategories(JSON.parse((0,s.default)(t.serviceOptionItem.list.sku)))},function(e){t.orderFilling.category.value=e[0],t.orderFilling.category.isJumpingCategory=!1,t.orderFilling.category.categoryList=e,1===e.length?(t.linkFlag=!1,t.remarksFlag=!0,t.getExpand()):(t.linkFlag=!0,t.remarksFlag=!1,t.initOrder())},p.defaultPreHandler,!0);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getBrandList:function(){var e=(0,o.default)(c.default.mark(function e(){var t,a=this;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loadInfo){e.next=5;break}if(t={sku:this.serviceOptionItem.list.sku,categoryId:this.orderFilling.category.value.categoryId,name:this.serviceOptionItem.list.name,page:"",limit:""},!this.orderFilling.category.value.categoryId||this.orderFilling.brand.value.brandId){e.next=5;break}return e.next=5,(0,p.loadData)(function(){return d.default.activationBrands(t)},function(e){a.orderFilling.brand.brandList=e},p.defaultPreHandler,!0);case 5:1===this.orderFilling.brand.brandList.length?(this.orderFilling.brand.value=this.orderFilling.brand.brandList[0],this.orderFilling.brand.isJumpingBrand=!1):this.orderFilling.brand.isJumpingBrand=!0;case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getExpand:function(){var e=(0,o.default)(c.default.mark(function e(){var t,a,i=this;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loadInfo){e.next=5;break}return t={servicePackId:this.params.servicePackId,categoryId:this.orderFilling.category.value.categoryId},e.next=4,(0,p.loadData)(function(){return d.default.getObjectExpands(t)},function(e){i.expand.expands=e},p.defaultPreHandler,!0);case 4:u.default.forEach(this.expand.expands,function(e){e.isNull?e.state="success":e.state="default",(0,n.default)(e,{value:null})});case 5:if(this.expand.otherExpand=this.expand.expands.filter(function(e){return 1!==e.contentTypeCode&&3!==e.contentTypeCode}),this.expand.timeExpand=this.expand.expands.filter(function(e){return 1===e.contentTypeCode}),this.expand.timeExpand&&this.expand.timeExpand.length>0&&(this.orderFilling.purchaseTime?this.expand.timeExpand[0].value=this.orderFilling.purchaseTime:this.orderFilling.purchaseTime=this.expand.timeExpand[0].value),this.expand.imageExpand=this.expand.expands.filter(function(e){return 3===e.contentTypeCode}),a=this.expand.expands.filter(function(e){return 5===e.contentTypeCode}),this.expand.showLocation=!!(a.length>0&&a[0].value),!(a.length>0)||a[0].value){e.next=14;break}return e.next=14,this.fixPosition();case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),fixPosition:function(){var e=(0,o.default)(c.default.mark(function e(){var t,a,i;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=navigator.userAgent,!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?(a=this,f.default.getLocation({type:"wgs84",success:function(){var e=(0,o.default)(c.default.mark(function e(t){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.loadData)(function(){return d.default.geocode(t.latitude,t.longitude,3)},function(e){e&&(a.address.province.id=e.provinceId,a.address.city.id=e.cityId,a.address.county.id=e.districtId,a.address.desc=e.street),a.expand.showLocation=!0},p.defaultPreHandler,!0);case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),fail:function(){a.toast("获取不到位置信息"),a.expand.showLocation=!0},cancel:function(){a.expand.showLocation=!0}})):navigator.geolocation&&(i={timeout:3e3,maximumAge:0},navigator.geolocation.getCurrentPosition(this.geoSuccess,this.geoError,i));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),geoSuccess:function(){var e=(0,o.default)(c.default.mark(function e(t){var a=this;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.loadData)(function(){return d.default.geocode(t.coords.latitude,t.coords.longitude,3)},function(e){e&&(a.address.province.id=e.provinceId,a.address.city.id=e.cityId,a.address.county.id=e.districtId,a.address.desc=e.street)},p.defaultPreHandler,!0);case 2:this.expand.showLocation=!0;case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),geoError:function(e){switch(e.code){case e.POSITION_UNAVAILABLE:case e.TIMEOUT:this.toast("获取不到位置信息");break;case e.UNKNOWN_ERROR:this.toast("未知错误")}this.expand.showLocation=!0},setPickerDefaultIndex:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"id",i=e.getSlotValues(0).find(function(e){return e[a]===t});i&&e.setSlotValue(0,i)},getGeography:function(){var e=(0,o.default)(c.default.mark(function e(t){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={geographyType:r,parentId:i},e.next=3,(0,p.loadData)(function(){return d.default.getGeography(a)},function(e){t.setSlotValues(0,e.geographyDtos)},p.defaultPreHandler,!0);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),chooseProvince:function(){var e=(0,o.default)(c.default.mark(function e(){var t;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.$refs.provincePickerObject[0],this.address.province=t.getValues()[0],this.provincePicker.show=!1,this.cityPicker.show=!0;case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),chooseCity:function(){var e=(0,o.default)(c.default.mark(function e(){var t;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.$refs.cityPickerObject[0],this.address.city=t.getValues()[0],this.cityPicker.show=!1,this.countyPicker.show=!0;case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),chooseCounty:function(){var e=this.$refs.countyPickerObject[0];this.address.county=e.getSlotValue(0),this.countyPicker.show=!1},goToPageBrand:function(){this.orderFilling.category.value.categoryId&&this.remarksFlag&&this.$router.push({name:"hbBrand",query:{name:"",storeId:this.params.storeId,sku:this.serviceOptionItem.list.sku,category:this.orderFilling.category.value.categoryId,orderId:this.orderId,projectId:this.params.projectId}})},scanQRCode:function(e){var t=this,a=u.default.findIndex(this.expand.otherExpand,{id:e});f.default.scanQRCode({desc:"scanQRCode desc",needResult:1,scanType:["qrCode","barCode"],success:function(e){var i=e.resultStr,r=e.resultStr.indexOf(",")+1;i=i.slice(r),t.expand.otherExpand[a].value=i,t.$set(t.expand.otherExpand,a,t.expand.otherExpand[a])},error:function(e){e.errMsg.indexOf("function_not_exist")>0&&alert("版本过低请升级")}})},chooseImage:function(e){var t=this;this.expand.submitImage=!0;var a=u.default.findIndex(this.expand.imageExpand,{id:e});f.default.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(){var e=(0,o.default)(c.default.mark(function e(i){return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.$set(t.expand.imageExpand[a],"src",i.localIds[0]),t.$set(t.expand.imageExpand[a],"save",!0),t.uploadImage(a,i.localIds[0]);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),fail:function(){t.expand.submitImage=!1},cancel:function(){t.expand.submitImage=!1}})},getLocalImageDate:function(e,t){var a=this;f.default.getLocalImgData({localId:t,success:function(t){var i=t.localData;a.$set(a.expand.imageExpand[e],"src",i)}})},uploadImage:function(e,t){var a=this;f.default.uploadImage({localId:t,isShowProgressTips:1,success:function(i){a.expand.imageExpand[e].value=i.serverId;!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&a.getLocalImageDate(e,t),a.expand.submitImage=!1},fail:function(){this.toast("图片上传失败，请重试"),a.expand.submitImage=!1}})},confirmExpands:function(){var e=this,t=this.expand.expands.filter(function(e){return!e.isNull}),a=t.filter(function(e){return""!==e.regex}),i=u.default.filter(t,{regex:""});return u.default.forEach(i,function(e){e.value?e.state="success":e.state="default"}),u.default.forEach(a,function(t){var a=new RegExp(t.regex,"i");if(t.value){var i=a.test(t.value);t.state=i?"success":"default"}else t.state="default";if(1===t.contentTypeCode&&t.value){var r=(0,l.default)(t.value).toDate(),n=e.orderFilling.purchaseTime,s=(0,l.default)(n).toDate();parseInt((s-r)/1e3/60/60/24)>t.regex?t.state="default":t.state="success"}}),this.expand.expands.find(function(e){return"default"===e.state})},toast:function(e){(0,h.Toast)({message:e,position:"middle",duration:2e3})},confirm:function(){this.expand.confirm=!1;var e=this.expand.expands.find(function(e){return 5===e.contentTypeCode});e&&(e=!e.isNull),/^([A-Za-z\u4e00-\u9fa5]{2,14})$/.test(this.customerName)?/^(86)*0*1\d{10}$/.test(this.phoneNumber)?this.purchasePrice?this.timePicker.viewDate?this.orderFilling.category.value.categoryId?this.orderFilling.brand.value.brandId?e&&!this.address.province.id?this.toast("请选择省"):e&&!this.address.city.id?this.toast("请选择市"):e&&!this.address.county.id?this.toast("请选择县"):e&&""===this.address.desc?this.toast("请输入详细地址"):this.agreeChecked?this.expand.confirm=!0:this.toast("请勾选服务条款"):this.toast("请选择品牌"):this.toast("请选择品类"):this.toast("请选择购机日期"):this.toast("请输入购机金额"):this.toast("请输入11位手机号"):this.toast("请输入正确的客户姓名")},postData:function(){var e=(0,o.default)(c.default.mark(function e(){var t,a,i,n,s,o,l=this;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,a=!1,i=void 0,e.prev=3,n=c.default.mark(function e(){var t;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(3!==(t=o.value).contentTypeCode||!t.save){e.next=4;break}return e.next=4,(0,p.loadData)(function(){return d.default.getImage(t.value,20)},function(e){t.value=e.id},p.defaultPreHandler,!0);case 4:case"end":return e.stop()}},e,l)}),s=(0,r.default)(this.expand.expands);case 6:if(t=(o=s.next()).done){e.next=11;break}return e.delegateYield(n(),"t0",8);case 8:t=!0,e.next=6;break;case 11:e.next=17;break;case 13:e.prev=13,e.t1=e.catch(3),a=!0,i=e.t1;case 17:e.prev=17,e.prev=18,!t&&s.return&&s.return();case 20:if(e.prev=20,!a){e.next=23;break}throw i;case 23:return e.finish(20);case 24:return e.finish(17);case 25:return this.setOrderFilling(),this.getOrderFillingData(),this.setFillingData(),e.next=30,(0,p.loadData)(function(){return d.default.activateSavingOrder(l.data)},function(e){e.isOk?(l.orderId=e.content,d.default.submitOrders(l.orderId),l.initOrder(),l.$router.replace({name:"activation_success",query:{}}),window.localStorage.removeItem("agreeChecked"),window.localStorage.removeItem("memoryFlag"),window.localStorage.removeItem("phoneNumber"),window.localStorage.removeItem("customerName")):l.toast(e.message)});case 30:case"end":return e.stop()}},e,this,[[3,13,17,25],[18,,20,24]])}));return function(){return e.apply(this,arguments)}}(),submitOrder:function(){var e=(0,o.default)(c.default.mark(function e(){var t,a,i,n,o,d,l=this;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.expand.submitImage){e.next=4;break}this.toast("图片上传中，请稍候..."),e.next=27;break;case 4:for(t=!0,a=!1,i=void 0,e.prev=7,n=(0,r.default)(this.expand.expands);!(t=(o=n.next()).done);t=!0)5===(d=o.value).contentTypeCode&&(d.value=(0,s.default)({addressDescription:this.address.desc,city:this.address.city.name,cityId:this.address.city.id,county:this.address.county.name,countyId:this.address.county.id,province:this.address.province.name,provinceId:this.address.province.id}));e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),a=!0,i=e.t0;case 15:e.prev=15,e.prev=16,!t&&n.return&&n.return();case 18:if(e.prev=18,!a){e.next=21;break}throw i;case 21:return e.finish(18);case 22:return e.finish(15);case 23:if(this.confirm(),!this.expand.confirm){e.next=27;break}return e.next=27,(0,p.loadData)(function(){return l.postData()});case 27:case"end":return e.stop()}},e,this,[[7,11,15,23],[16,,18,22]])}));return function(){return e.apply(this,arguments)}}(),setFillingData:function(){var e=this;this.data.order={cardId:this.serviceOptionItem.list.cardId,sku:this.serviceOptionItem.list.sku,storeId:this.params.storeId,projectId:this.params.projectId,brandId:this.orderFilling.brand.value.brandId,categoryId:this.orderFilling.category.value.categoryId,customerName:window.localStorage.getItem("customerName"),customerPhone:window.localStorage.getItem("phoneNumber"),purchasePrice:this.orderFilling.purchasePrice||"",purchaseTime:this.orderFilling.purchaseTime};var t=[],a="";u.default.forEach(this.expand.expands,function(i){var r={customerDeviceExpandId:i.id,customerDeviceExpandValue:i.value||""};1===i.contentTypeCode&&(r.customerDeviceExpandValue=e.orderFilling.purchaseTime),t.push(r);new RegExp("备注").test(i.name)&&(a=i.value||"")}),this.data.order.expandData=t,this.data.order.remark=a}},computed:{isCategoryPlaceholder:function(){return"请选择品类"===this.orderFilling.category.value.categoryName},isBrandPlaceholder:function(){return"请选择品牌"===this.orderFilling.brand.value.brandName}},watch:{customerName:function(e){window.localStorage.setItem("customerName",e)},phoneNumber:function(e){window.localStorage.setItem("phoneNumber",e)},"provincePicker.show":function(e){if(e&&!this.address.province.id){var t=this.$refs.provincePickerObject[0];0===t.getSlotValues(0).length&&this.getGeography(t)}},"cityPicker.show":function(e){e&&(this.address.province.id||(this.cityPicker.show=!1,this.toast("请先选择开户省")))},"countyPicker.show":function(e){e&&(this.address.city.id||(this.countyPicker.show=!1,this.toast("请先选择开户省市")))},"address.province.id":function(e,t){var a=this;e&&this.$nextTick((0,o.default)(c.default.mark(function i(){var r;return c.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(0!==(r=a.$refs.provincePickerObject[0]).getSlotValues(0).length||null!==t){i.next=11;break}return i.next=4,a.getGeography(r);case 4:if(a.setPickerDefaultIndex(r,e,"id"),a.address.province.name=r.getSlotValues(0).find(function(t){return t.id===e})?r.getSlotValues(0).find(function(t){return t.id===e}).name:"",a.address.city.id){i.next=9;break}return i.next=9,a.getGeography(a.$refs.cityPickerObject[0],e,1);case 9:i.next=17;break;case 11:return i.next=13,a.getGeography(a.$refs.cityPickerObject[0],e,1);case 13:a.address.city.id=null,a.address.city.name="",a.address.county.id=null,a.address.county.name="";case 17:case"end":return i.stop()}},i,a)})))},"address.city.id":function(e,t){var a=this;e&&this.$nextTick((0,o.default)(c.default.mark(function i(){var r;return c.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(0!==(r=a.$refs.cityPickerObject[0]).getSlotValues(0).length||null!==t){i.next=11;break}return i.next=4,a.getGeography(r,a.address.province.id,1);case 4:if(a.setPickerDefaultIndex(r,e,"id"),a.address.city.name=r.getSlotValues(0).find(function(t){return t.id===e})?r.getSlotValues(0).find(function(t){return t.id===e}).name:"",a.address.county.id){i.next=9;break}return i.next=9,a.getGeography(a.$refs.countyPickerObject[0],e,1);case 9:i.next=15;break;case 11:return i.next=13,a.getGeography(a.$refs.countyPickerObject[0],e,2);case 13:a.address.county.id=null,a.address.county.name="";case 15:case"end":return i.stop()}},i,a)})))},"address.county.id":function(){var e=(0,o.default)(c.default.mark(function e(t,a){var i=this;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t&&this.$nextTick((0,o.default)(c.default.mark(function e(){var r;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(r=i.$refs.countyPickerObject[0]).getSlotValues(0).length||null!==a){e.next=6;break}return e.next=4,i.getGeography(r,i.address.city.id,2);case 4:i.setPickerDefaultIndex(r,t,"id"),i.address.county.name=r.getSlotValues(0).find(function(e){return e.id===t})?r.getSlotValues(0).find(function(e){return e.id===t}).name:"";case 6:case"end":return e.stop()}},e,i)})));case 1:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()}}}});
//# sourceMappingURL=39.f088b5c5fcbb2274ea40.js.map