webpackJsonp([23],{MUwp:function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=s(a("Xxa5")),i=s(a("exGp")),n=s(a("3D1+")),u=a("JaHG"),o=s(a("31Wn")),c=a("Au9i");t.default={name:"PayList",components:{Progress:o.default},data:function(){return{query:{paymentId:NaN,payType:NaN,payerType:NaN},payTypeValue:"",orderDetail:{payAmount:"",orderCode:""},gender:"",payMethod:{cashierPay:!1,smsPay:!1,weiXinPay:!1,weChatPay:!1},timeInterval:null,useWeChatPay:!0,pushName:"",orderId:null,isRedirect:!0}},created:function(){var e=(0,i.default)(r.default.mark(function e(){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.orderId=this.$route.query.orderId,e.next=3,this.getDetail();case 3:return e.next=5,this.getMethod();case 5:return e.next=7,this.redirect();case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),methods:{getDetail:function(){var e=(0,i.default)(r.default.mark(function e(){var t=this;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.loadData)(function(){return n.default.getOrderDetail(t.orderId)},function(e){t.orderDetail.payAmount=e.paymentDto.payAmount,t.orderDetail.orderCode=e.orderCode,t.query.paymentId=e.paymentDto.id},u.defaultPreHandler,!0);case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getMethod:function(){var e=(0,i.default)(r.default.mark(function e(){var t=this;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.loadData)(function(){return n.default.getPaymentMethod(t.query.paymentId)},function(e){var a=e;t.payMethod.cashierPay=a.cashierPay,t.payMethod.smsPay=a.smsPay,t.payMethod.weiXinPay=a.weixinPay},u.defaultPreHandler,!0);case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),redirect:function(){var e=(0,i.default)(r.default.mark(function e(){var t=this;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.payMethod.weiXinPay||!this.payMethod.cashierPay||this.payMethod.smsPay){e.next=7;break}return this.payTypeValue="收银台支付",this.getPayType(),e.next=5,(0,u.loadData)(function(){return n.default.postPayConfirm(t.query)},function(e){e&&t.$router.replace({name:t.pushName,query:{orderId:t.orderId}})},u.boolPreHandler,!0);case 5:e.next=8;break;case 7:this.isRedirect=!1;case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getPayType:function(){switch(this.payTypeValue){case"微信支付":this.query.payType=2,this.query.payerType=20;break;case"我用微信代付":this.query.payType=2,this.query.payerType=30;break;case"支付宝支付":this.query.payType=0,this.query.payerType=20;break;case"收银台支付":this.query.payType=1,this.query.payerType=40}var e=[this.query.payType,this.query.payerType].join("");this.pushName=this.$route.meta.pushName[e]},goToPay:function(){var e=(0,i.default)(r.default.mark(function e(){var t=this;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.payTypeValue){e.next=11;break}if(this.getPayType(),"我用微信代付"!==this.payTypeValue){e.next=7;break}return e.next=5,this.weChatPay();case 5:e.next=9;break;case 7:return e.next=9,(0,u.loadData)(function(){return n.default.postPayConfirm(t.query)},function(e){e&&("支付宝支付"===t.payTypeValue&&(window.history.pushState({},"title","#/login"),window.history.pushState({},"title","#/MyOrder")),t.$router.push({name:t.pushName,query:{orderId:t.orderId}}))},u.boolPreHandler,!0);case 9:e.next=12;break;case 11:(0,c.MessageBox)({title:"提示",message:"请先选择支付方式"});case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),weChatPay:function(){var e=(0,i.default)(r.default.mark(function e(){var t,a,s=this;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this,!this.useWeChatPay){e.next=13;break}return this.useWeChatPay=!1,e.next=5,n.default.postPayConfirm(this.query);case 5:if(!e.sent.isOk){e.next=12;break}return a=location.href.split("#")[0],e.next=10,(0,u.loadData)(function(){return s.$initWxConfig(a,["getBrandWCPayRequest"])},(0,i.default)(r.default.mark(function e(){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.loadData)(function(){return n.default.sales(t.query.paymentId)},function(e){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appId,timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:"MD5",paySign:e.paySign},function(e){"get_brand_wcpay_request:ok"===e.err_msg&&(t.payMethod.weChatPay=!0),t.useWeChatPay=!0})},u.defaultPreHandler,!0);case 2:case"end":return e.stop()}},e,s)})));case 10:e.next=13;break;case 12:t.useWeChatPay=!0;case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},watch:{"payMethod.weChatPay":function(){var e=(0,i.default)(r.default.mark(function e(t){return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:!0===t&&(window.history.pushState({},"title","#/login"),window.history.pushState({},"title","#/MyOrder"),this.$router.push({name:this.pushName,query:{orderId:this.orderId}}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}}},TtEu:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("MUwp"),r=a.n(s),i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.isRedirect?e._e():a("div",{staticClass:"PayList"},[a("Progress"),e._v(" "),a("div",{staticClass:"bg_img_none m_t"},[a("mt-cell",{attrs:{title:"订单编号"}},[a("span",[e._v(e._s(e.orderDetail.orderCode))])]),e._v(" "),a("mt-cell",{attrs:{title:"应付金额"}},[a("span",{staticClass:"pay-amount"},[e._v("￥"+e._s(e.orderDetail.payAmount)+" 元")])])],1),e._v(" "),a("p",{staticClass:"title"},[e._v("请选择支付方式")]),e._v(" "),e.payMethod.weiXinPay?a("div",{staticClass:"mt-10"},[a("div",{staticClass:"item_container"},[a("div",{staticClass:"item_p"},[e._m(0),e._v(" "),e._m(1),e._v(" "),a("label",{staticClass:"pay-label"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.payTypeValue,expression:"payTypeValue"}],staticClass:"pay-radio",attrs:{type:"radio",name:"pay-radio",value:"微信支付"},domProps:{checked:e._q(e.payTypeValue,"微信支付")},on:{change:function(t){e.payTypeValue="微信支付"}}}),e._v(" "),a("span",{staticClass:"pay-radioInput"})])])])]):e._e(),e._v(" "),e.payMethod.smsPay?a("div",{staticClass:"mt-10"},[a("div",{staticClass:"item_container"},[a("div",{staticClass:"item_p"},[e._m(2),e._v(" "),e._m(3),e._v(" "),a("label",{staticClass:"pay-label"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.payTypeValue,expression:"payTypeValue"}],staticClass:"pay-radio",attrs:{type:"radio",name:"pay-radio",value:"支付宝支付"},domProps:{checked:e._q(e.payTypeValue,"支付宝支付")},on:{change:function(t){e.payTypeValue="支付宝支付"}}}),e._v(" "),a("span",{staticClass:"pay-radioInput"})])])])]):e._e(),e._v(" "),e.payMethod.weiXinPay?a("div",{staticClass:"mt-10"},[a("div",{staticClass:"item_container"},[a("div",{staticClass:"item_p"},[e._m(4),e._v(" "),e._m(5),e._v(" "),a("label",{staticClass:"pay-label"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.payTypeValue,expression:"payTypeValue"}],staticClass:"pay-radio",attrs:{type:"radio",name:"pay-radio",value:"我用微信代付"},domProps:{checked:e._q(e.payTypeValue,"我用微信代付")},on:{change:function(t){e.payTypeValue="我用微信代付"}}}),e._v(" "),a("span",{staticClass:"pay-radioInput"})])])])]):e._e(),e._v(" "),e.payMethod.cashierPay?a("div",{staticClass:"mt-10"},[a("div",{staticClass:"item_container"},[a("div",{staticClass:"item_p"},[e._m(6),e._v(" "),e._m(7),e._v(" "),a("label",{staticClass:"pay-label"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.payTypeValue,expression:"payTypeValue"}],staticClass:"pay-radio",attrs:{type:"radio",name:"pay-radio",value:"收银台支付"},domProps:{checked:e._q(e.payTypeValue,"收银台支付")},on:{change:function(t){e.payTypeValue="收银台支付"}}}),e._v(" "),a("span",{staticClass:"pay-radioInput"})])])])]):e._e(),e._v(" "),a("div",{staticClass:"bottom-button"},[a("mt-button",{attrs:{type:"primary",size:"large"},on:{click:function(t){e.goToPay()}}},[e._v("确认支付："+e._s(e.orderDetail.payAmount)+"元")])],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"item_img"},[t("img",{attrs:{src:"/static/wechat_2.png"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"item_content"},[t("p",{},[this._v("微信支付")]),this._v(" "),t("p",{staticClass:"item_font12 item_color"},[this._v("点击进入，顾客扫码支付")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"item_img"},[t("img",{attrs:{src:"/static/alipay.png"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"item_content"},[t("p",{},[this._v("支付宝支付")]),this._v(" "),t("p",{staticClass:"item_font12 item_color"},[this._v("发送短信，顾客点击支付")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"item_img"},[t("img",{attrs:{src:"/static/wechat_2.png"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"item_content"},[t("p",{},[this._v("我用微信代付")]),this._v(" "),t("p",{staticClass:"item_font12 item_color"},[this._v("点击进入，代顾客支付")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"item_img"},[t("img",{attrs:{src:"/static/cashier.jpg"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"item_content"},[t("p",{},[this._v("顾客在收银台支付")]),this._v(" "),t("p",{staticClass:"item_font12 item_color"},[this._v("顾客支付现金")])])}]},n=function(e){a("qeey")},u=a("VU/8")(r.a,i,!1,n,"data-v-501f0550",null);t.default=u.exports},qeey:function(e,t){}});
//# sourceMappingURL=23.841e67d7906e6f9ca609.js.map