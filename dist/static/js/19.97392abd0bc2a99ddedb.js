webpackJsonp([19],{OftD:function(t,e){},W1Js:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("tL6u"),i=s.n(a),n={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"Decomposition"},[s("div",{staticClass:"form"},[s("div",{staticClass:"title bg_img_none"},[s("mt-cell",[s("p",{attrs:{slot:"title"},slot:"title"},[t._v("任务名称")])])],1),t._v(" "),s("div",{staticClass:"box"},[s("div",{staticClass:"container"},[s("div",{staticClass:"bg_img_none"},[s("mt-cell",{attrs:{title:t.detail.task.taskName}})],1)])]),t._v(" "),s("div",{staticClass:"title bg_img_none"},[s("mt-cell",[s("p",{attrs:{slot:"title"},slot:"title"},[t._v("任务概览")])])],1),t._v(" "),s("div",{staticClass:"box"},t._l(t.detail.task.taskItems,function(e){return s("div",{key:e.id,staticClass:"container"},[s("div",{staticClass:"bg_img_none"},[s("mt-cell",{attrs:{title:e.name}},[s("span",{staticClass:"fontfamily"},[t._v(t._s(e.target))]),t._v(" "),"销售量"===e.targetType?s("span",{staticClass:"fontfamily"},[t._v("单")]):s("span",{staticClass:"fontfamily"},[t._v("元")])])],1),t._v(" "),s("div",{staticClass:"bg_img_none computed"},[s("mt-cell",{attrs:{title:"已分配"}},[s("div",{staticClass:"flex t-l"},[t._v(t._s(e.taskAllocateRate)+"%")]),t._v(" "),s("div",{staticClass:"flex t-r"},[t._v(t._s(e.distribute))])]),t._v(" "),s("mt-cell",{attrs:{title:"已完成"}},[s("div",{staticClass:"flex t-l"},[t._v(t._s(e.progressRate)+"%")]),t._v(" "),s("div",{staticClass:"flex t-r"},[t._v(t._s(e.progress))])])],1)])})),t._v(" "),t.detail.task.reward.length>0?s("div",{staticClass:"title bg_img_none"},[s("mt-cell",[s("p",{attrs:{slot:"title"},slot:"title"},[t._v("奖励概览")])])],1):t._e(),t._v(" "),s("div",{staticClass:"first_img"},t._l(t.detail.task.reward,function(t){return s("mt-cell",{key:t.id,attrs:{title:t.taskIncomeObject+"："+t.incomeAllocate+"/"+t.incomeValue,value:"已分配："+t.incomeAllocateRate+"%"}})}))]),t._v(" "),s("div",{staticClass:"form title bg_img_none"},[s("mt-cell",[s("p",{attrs:{slot:"title"},slot:"title"},[t._v("人员筛选")])])],1),t._v(" "),s("div",{staticClass:"popup bg_img_none",on:{click:function(e){t.filterPickerObject.popupVisible=!0}}},[s("mt-cell",{staticClass:"filter",attrs:{"is-link":""}},[s("span",{attrs:{slot:"title"},slot:"title"},[t._v("当前显示")]),t._v(" "),s("span",[t._v(t._s(t.filterPickerObject.filterOrg))]),t._v(" "),s("span",{staticClass:"mar-l-r"},[t._v("—")]),t._v(" "),s("span",[t._v(t._s(t.filterPickerObject.filterPosition))])])],1),t._v(" "),s("mt-popup",{attrs:{position:"middle"},model:{value:t.filterPickerObject.popupVisible,callback:function(e){t.$set(t.filterPickerObject,"popupVisible",e)},expression:"filterPickerObject.popupVisible"}},[s("mt-picker",{ref:"filterPicker",attrs:{slots:t.filterPickerObject.slots,"value-key":"name",visibleItemCount:3,showToolbar:!0},on:{change:t.onValuesChange}}),t._v(" "),s("button",{staticClass:"button",on:{click:function(e){t.setFilter()}}},[t._v("确定")])],1),t._v(" "),s("div",{staticClass:"form title bg_img_none"},[s("mt-cell",[s("p",{attrs:{slot:"title"},slot:"title"},[t._v("下级任务")])])],1),t._v(" "),s("transition-group",{attrs:{name:"list",tag:"div"}},t._l(t.showSameLevelSubTask,function(e,a){return s("div",{key:a,staticClass:"case"},[s("div",{staticClass:"subTask bg_img_none"},[s("mt-cell",[s("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.personName)),e.taskStatus?s("mt-badge",{attrs:{size:"normal",type:"warning"}},[t._v(t._s(e.taskStatus))]):t._e()],1),t._v(" "),e.task&&"新建"!==e.taskStatus?s("span",{staticClass:"subTaskSpan"},[t._v("完成进度: "+t._s(e.task.finishRate)+"%")]):t._e()]),t._v(" "),s("mt-cell",[s("span",{staticClass:"organizeTitle",attrs:{slot:"title"},slot:"title"},[t._v("组织")]),t._v(" "),s("span",{staticClass:"organizeValue"},[t._v(t._s(e.organizationNamePath))])]),t._v(" "),s("mt-cell",[s("span",{staticClass:"organizeTitle",attrs:{slot:"title"},slot:"title"},[t._v("职位")]),t._v(" "),s("span",{staticClass:"organizeValue"},[t._v(t._s(e.positionName))])])],1),t._v(" "),e.task?s("div",{staticClass:"form",class:{pb_10:"新建"===e.taskStatus}},[s("div",{staticClass:"bg_img_none"},t._l(e.task.taskItems,function(e){return s("div",{key:e.id},[s("div",{staticClass:"bg_img_none"},[s("mt-cell",{attrs:{title:e.name}},[s("span",{staticClass:"fontfamily"},[t._v(t._s(e.target))]),t._v(" "),"销售量"===e.targetType?s("span",{staticClass:"fontfamily"},[t._v("单")]):s("span",{staticClass:"fontfamily"},[t._v("元")])])],1),t._v(" "),s("div",{staticClass:"bg_img_none computed"},[s("mt-cell",{attrs:{title:"已完成"}},[s("div",{staticClass:"flex t-l"},[t._v(t._s(e.progressRate)+"%")]),t._v(" "),s("div",{staticClass:"flex t-r"},[t._v(t._s(e.progress))])])],1)])})),t._v(" "),e.task.reward.length>0?s("div",{staticClass:"bg_img_none"},[s("mt-cell",[s("p",{attrs:{slot:"title"},slot:"title"},t._l(e.task.reward,function(e){return s("span",{staticClass:"t-l w-3 f-s-10",class:{database:"佣金"===e.taskIncomeObject,star:"经验"===e.taskIncomeObject,leaf:"积分"===e.taskIncomeObject}},[s("i",{staticClass:"fa",attrs:{"aria-hidden":"true"}}),t._v(" "),"佣金"===e.taskIncomeObject?s("span",[t._v("+"+t._s(e.incomeValue)+" 元")]):s("span",[t._v("+"+t._s(e.incomeValue)+"/"+t._s(e.taskIncomeObject))])])}))])],1):t._e(),t._v(" "),"新建"===e.taskStatus?s("div",{staticClass:"btn submit",on:{touchstart:function(e){t.btnStart()},touchend:function(e){t.btnEnd()}}},[s("mt-button",{attrs:{type:"primary",size:"large"},on:{click:function(s){t.resetTask(e.personTaskId)}}},[t._v("重置")]),t._v(" "),s("mt-button",{attrs:{type:"primary",size:"large"},on:{click:function(s){t.submit(e.personTaskId,1)}}},[t._v("提交")])],1):t._e()]):s("div",{staticClass:"form",class:{pb_10:t.income}},[s("div",{staticClass:"bg_img_none"},t._l(t.detail.task.taskItems,function(t){return s("div",{key:t.id},[s("mt-cell",{attrs:{title:t.name,value:"未分配"}})],1)})),t._v(" "),t.detail.task.reward.length>0?s("div",{staticClass:"bg_img_none"},[s("mt-cell",[s("p",{attrs:{slot:"title"},slot:"title"},t._l(t.detail.task.reward,function(e){return s("span",{staticClass:"t-l w-3 f-s-10",class:{database:"佣金"===e.taskIncomeObject,star:"经验"===e.taskIncomeObject,leaf:"积分"===e.taskIncomeObject}},[s("i",{staticClass:"fa",attrs:{"aria-hidden":"true"}}),t._v(" "),"佣金"===e.taskIncomeObject?s("span",[t._v("+0 元")]):s("span",[t._v("+0/"+t._s(e.taskIncomeObject))])])}))])],1):t._e(),t._v(" "),t.income?s("div",{staticClass:"btn",on:{touchstart:function(e){t.btnStart()},touchend:function(e){t.btnEnd()}}},[s("mt-button",{attrs:{type:"primary",size:"large"},on:{click:function(s){t.goToPageSub(e.personId,1,t.detail.taskId)}}},[t._v("分配\n          ")])],1):t._e()])])})),t._v(" "),s("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"}],attrs:{"infinite-scroll-disabled":"loading","infinite-scroll-distance":"300"}},[s("transition-group",{attrs:{name:"list",tag:"div"}},t._l(t.showSubLevelSubTask,function(e,a){return s("div",{key:a,staticClass:"case"},[s("div",{staticClass:"subTask bg_img_none"},[s("mt-cell",[s("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.personName)),e.taskStatus?s("mt-badge",{attrs:{size:"normal",type:"warning"}},[t._v(t._s(e.taskStatus))]):t._e()],1),t._v(" "),e.task&&"新建"!==e.taskStatus?s("span",{staticClass:"subTaskSpan"},[t._v("完成进度: "+t._s(e.task.finishRate)+"%")]):t._e()]),t._v(" "),s("mt-cell",[s("span",{staticClass:"organizeTitle",attrs:{slot:"title"},slot:"title"},[t._v("组织")]),t._v(" "),s("span",{staticClass:"organizeValue"},[t._v(t._s(e.organizationNamePath))])]),t._v(" "),s("mt-cell",[s("span",{staticClass:"organizeTitle",attrs:{slot:"title"},slot:"title"},[t._v("职位")]),t._v(" "),s("span",{staticClass:"organizeValue"},[t._v(t._s(e.positionName))])])],1),t._v(" "),e.task?s("div",{staticClass:"form",class:{pb_10:"新建"===e.taskStatus}},[s("div",{staticClass:"bg_img_none"},t._l(e.task.taskItems,function(e){return s("div",{key:e.id},[s("div",{staticClass:"bg_img_none"},[s("mt-cell",{attrs:{title:e.name}},[s("span",{staticClass:"fontfamily"},[t._v(t._s(e.target))]),t._v(" "),"销售量"===e.targetType?s("span",{staticClass:"fontfamily"},[t._v("单")]):s("span",{staticClass:"fontfamily"},[t._v("元")])])],1),t._v(" "),s("div",{staticClass:"bg_img_none computed"},[s("mt-cell",{attrs:{title:"已分配"}},[s("div",{staticClass:"flex t-l"},[t._v(t._s(e.taskAllocateRate)+"%")]),t._v(" "),s("div",{staticClass:"flex t-r"},[t._v(t._s(e.distribute))])]),t._v(" "),s("mt-cell",{attrs:{title:"已完成"}},[s("div",{staticClass:"flex t-l"},[t._v(t._s(e.progressRate)+"%")]),t._v(" "),s("div",{staticClass:"flex t-r"},[t._v(t._s(e.progress))])])],1)])})),t._v(" "),e.task.reward.length>0?s("div",{staticClass:"bg_img_none"},[s("mt-cell",[s("p",{attrs:{slot:"title"},slot:"title"},t._l(e.task.reward,function(e){return s("span",{staticClass:"t-l w-3 f-s-10",class:{database:"佣金"===e.taskIncomeObject,star:"经验"===e.taskIncomeObject,leaf:"积分"===e.taskIncomeObject}},[s("i",{staticClass:"fa",attrs:{"aria-hidden":"true"}}),t._v(" "),"佣金"===e.taskIncomeObject?s("span",[t._v("+"+t._s(e.incomeValue)+" 元")]):s("span",[t._v("+"+t._s(e.incomeValue)+"/"+t._s(e.taskIncomeObject))])])}))])],1):t._e(),t._v(" "),"新建"===e.taskStatus?s("div",{staticClass:"btn submit",on:{touchstart:function(e){t.btnStart()},touchend:function(e){t.btnEnd()}}},[s("mt-button",{attrs:{type:"primary",size:"large"},on:{click:function(s){t.resetTask(e.personTaskId)}}},[t._v("重置")]),t._v(" "),s("mt-button",{attrs:{type:"primary",size:"large"},on:{click:function(s){t.submit(e.personTaskId,0)}}},[t._v("提交")])],1):t._e()]):s("div",{staticClass:"form",class:{pb_10:e.decomposition&&t.income}},[s("div",{staticClass:"bg_img_none"},t._l(t.detail.task.taskItems,function(t){return s("div",{key:t.id},[s("mt-cell",{attrs:{title:t.name,value:"未分配"}})],1)})),t._v(" "),t.detail.task.reward.length>0?s("div",{staticClass:"bg_img_none"},[s("mt-cell",[s("p",{attrs:{slot:"title"},slot:"title"},t._l(t.detail.task.reward,function(e){return s("span",{staticClass:"t-l w-3 f-s-10",class:{database:"佣金"===e.taskIncomeObject,star:"经验"===e.taskIncomeObject,leaf:"积分"===e.taskIncomeObject}},[s("i",{staticClass:"fa",attrs:{"aria-hidden":"true"}}),t._v(" "),"佣金"===e.taskIncomeObject?s("span",[t._v("+0 元")]):s("span",[t._v("+0/"+t._s(e.taskIncomeObject))])])}))])],1):t._e(),t._v(" "),e.decomposition&&t.income?s("div",{staticClass:"btn",on:{touchstart:function(e){t.btnStart()},touchend:function(e){t.btnEnd()}}},[s("mt-button",{attrs:{type:"primary",size:"large"},on:{click:function(s){t.goToPageSub(e.personId,0,t.detail.taskId)}}},[t._v("分配\n            ")])],1):t._e()])])}))],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"load"},[s("mt-spinner",{attrs:{color:"#d4d4d4",type:"fading-circle"}}),t._v("\n    正在加载\n  ")],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.filterPickerObject.onFilterNone,expression:"filterPickerObject.onFilterNone"}],staticClass:"null_data"},[s("div",{staticClass:"null"}),t._v(" "),s("p",[t._v("该筛选条件下人员已分配完任务")])])],1)},staticRenderFns:[]},r=function(t){s("OftD")},l=s("VU/8")(i.a,n,!1,r,"data-v-16ba0e8e",null);e.default=l.exports},tL6u:function(t,e,s){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a(s("Gu7T")),n=a(s("BO1k")),r=a(s("mvHQ")),l=a(s("Dd8w")),o=a(s("Xxa5")),c=a(s("exGp")),u=s("NYxO"),f=s("Au9i"),d=a(s("3D1+")),v=a(s("M4fF")),k=s("JaHG");e.default={name:"DecompositionTask",data:function(){return{filterPickerObject:{popupVisible:!1,onFilterNone:!1,filterOrg:"",filterPosition:"",slots:[{flex:1,values:[],className:"slot1",textAlign:"center"},{divider:!0,content:"-",className:"slot2"},{flex:1,values:[],className:"slot3",textAlign:"center"}]},personTaskId:null,partnerId:null,loading:!1,detail:{task:{reward:[]},subPersonTaskIds:[]},sameLevelSubTask:[],subLevelSubTask:[],showSubLevelSubTask:[],showSameLevelSubTask:[],filterSubLevelSubTask:[],noMore:!0}},created:function(){var t=(0,c.default)(o.default.mark(function t(){var e=this;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.partnerId=Number(this.$route.query.partnerId),this.personTaskId=Number(this.$route.query.personTaskId),t.next=4,this.getTaskList();case 4:return t.next=6,(0,k.loadData)(function(){return e.initSubTask()});case 6:this.getSubTasksDetail(),this.setPositionName(),this.setStorageFilter(),this.noMore=this.filterSubLevelSubTask.length<10;case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),beforeRouteLeave:function(t,e,s){"Sub"!==t.name&&this.removeStorageDecomposition(),s()},methods:(0,l.default)({},(0,u.mapMutations)("task",["removeStorageDecomposition","setStorageDecomposition","resetSubTask"]),(0,u.mapActions)(["getOrganizationInfo","getSameInfo","getSubInfo"]),(0,u.mapActions)("task",["afterSubmit","resetSubPersonTask","getSubTask","getPersonTaskList","getDetail"]),{getTaskList:function(){var t=(0,c.default)(o.default.mark(function t(){var e,s,a,i,n,r=this;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!v.default.isEmpty(this.storePersonTask)){t.next=8;break}return e=1,s=this,a=function(){var t=(0,c.default)(o.default.mark(function t(){var i,n;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.getPersonTaskList(e);case 2:if(i=v.default.find(s.storePersonTask,{personTaskId:s.personTaskId})){t.next=9;break}return e++,t.next=7,a();case 7:t.next=12;break;case 9:return n={taskId:i.taskId,personTaskId:i.personTaskId},t.next=12,s.getDetail(n);case 12:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),t.next=6,a();case 6:t.next=13;break;case 8:if((i=v.default.find(this.storePersonTask,{personTaskId:this.personTaskId})).task){t.next=13;break}return n={taskId:i.taskId,personTaskId:i.personTaskId},t.next=13,(0,k.loadData)(function(){return r.getDetail(n)});case 13:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),initSubTask:function(){var t=(0,c.default)(o.default.mark(function t(){var e,s;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((e=v.default.find(this.storePersonTask,{personTaskId:this.personTaskId})).sameLevelSubTask){t.next=7;break}return t.next=4,this.initSubTaskPerson();case 4:return s={subPersonTaskIds:e.subPersonTaskIds,partnerId:this.partnerId,taskId:e.taskId},t.next=7,this.getSubTask(s);case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),initSubTaskPerson:function(){var t=(0,c.default)(o.default.mark(function t(){var e;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getOrganizationInfo(this.$store.state.person.personId);case 2:return e=v.default.find(this.$store.state.person.orgInfo,{partnerId:this.partnerId}).organizationId,t.next=5,this.getSameInfo(e);case 5:return t.next=7,this.getSubInfo(e);case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getSubTasksDetail:function(){var t=this,e=v.default.find(this.storePersonTask,{personTaskId:this.personTaskId}),s=JSON.parse((0,r.default)(e));this.sameLevelSubTask=s.sameLevelSubTask,this.subLevelSubTask=s.subLevelSubTask,this.setTaskProgress(s),s.task.reward=v.default.filter(s.task.reward,function(t){return"任务"!==t.taskIncomeObject}),v.default.forEach(s.task.reward,function(e){var s=t.incomeRewardAllocateValue(t.sameLevelSubTask,e.taskIncomeObject)+t.incomeRewardAllocateValue(t.subLevelSubTask,e.taskIncomeObject),a=s/e.incomeValue*100,i={incomeAllocate:s,incomeAllocateRate:a=a>0&&a<1?1:Math.floor(a)};v.default.assign(e,i)}),this.detail=s,this.canDecomposeAndProgress(),this.setIncome()},setTaskProgress:function(t){t.task.taskItems.map(function(e){var s=v.default.find(t.progress,{taskItemId:e.taskItemId}),a=parseInt(s.distribute||0),i=a/e.target*100,n=s.progress||0,r=n/e.target*100;i=i>0&&i<1?1:Math.floor(i),r=r>0&&r<1?1:Math.floor(r);var l={status:n.status,progress:n,progressRate:r,distribute:a,taskAllocateRate:i};v.default.assign(e,l)})},incomeRewardAllocateValue:function(t,e){var s=0,a=!0,i=!1,r=void 0;try{for(var l,o=(0,n.default)(t);!(a=(l=o.next()).done);a=!0){var c=l.value;if(c.task){var u=c.task.reward,f=v.default.find(u,{taskIncomeObject:e});s+=f?Number(f.incomeValue):0}}}catch(t){i=!0,r=t}finally{try{!a&&o.return&&o.return()}finally{if(i)throw r}}return s},canDecomposeAndProgress:function(){var t=this;v.default.forEach(this.sameLevelSubTask,function(e){e.decomposition?t.setTaskProgress(e):v.default.assign(e,{decomposition:!1})}),this.sameLevelSubTask=v.default.filter(this.sameLevelSubTask,function(t){return"生效"!==t.taskStatus}),v.default.forEach(this.subLevelSubTask,function(t){t.decomposition=!0}),v.default.forEach(this.subLevelSubTask,function(e){if(e.task){t.setTaskProgress(e);var s=e.organizationNamePath,a=v.default.filter(t.subLevelSubTask,{organizationNamePath:s}),i=!0,r=!1,l=void 0;try{for(var o,c=(0,n.default)(a);!(i=(o=c.next()).done);i=!0){var u=o.value;v.default.assign(u,{decomposition:!1})}}catch(t){r=!0,l=t}finally{try{!i&&c.return&&c.return()}finally{if(r)throw l}}e.decomposition=!0}}),this.subLevelSubTask=v.default.filter(this.subLevelSubTask,function(t){return!0===t.decomposition&&"生效"!==t.taskStatus}),this.showSameLevelSubTask=this.sameLevelSubTask,this.filterSubLevelSubTask=this.subLevelSubTask,this.showSubLevelSubTask=this.filterSubLevelSubTask.slice(0,10)},setPositionName:function(){var t=v.default.find(this.storePersonTask,{personTaskId:this.personTaskId}),e=JSON.parse((0,r.default)(t)),s=e.sameLevelSubTask,a=e.subLevelSubTask;this.setPositionNameItem("下级人员",a),this.setPositionNameItem("同级人员",s)},setPositionNameItem:function(t,e){if(e.length>0){var s={name:t,children:["全部显示"]};v.default.forEach(e,function(t){v.default.find(s.children,function(e){return e===t.positionName})||s.children.push(t.positionName)}),this.filterPickerObject.slots[0].values.push(s)}},setIncome:function(){this.detail.task.reward.length>0?this.income=v.default.find(this.detail.task.reward,function(t){return t.incomeAllocateRate<100}):this.income=!0},setPickerDefaultIndex:function(t){var e=this;this.$nextTick((0,c.default)(o.default.mark(function s(){var a,i;return o.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:a=e.$refs.filterPicker,(i=a.getSlotValues(0).find(function(e){return e.name===t[0]}))&&(a.setSlotValue(0,i),a.setSlotValues(1,i.children),a.setSlotValue(1,t[1]));case 3:case"end":return s.stop()}},s,e)})))},onValuesChange:function(t,e){var s=this;e[0]?t.setSlotValues(1,e[0].children):this.$nextTick(function(){t.setSlotValue(0,s.storeStorageDecomposition[0]),t.setSlotValues(1,e[0].children),t.setSlotValue(1,s.storeStorageDecomposition[1])})},setStorageFilter:function(){var t=!1;this.storeStorageDecomposition.length>0&&(t=v.default.find(this.filterPickerObject.slots[0].values,{name:this.storeStorageDecomposition[0]})),t?(this.filterPickerObject.filterOrg=this.storeStorageDecomposition[0],this.filterPickerObject.filterPosition=this.storeStorageDecomposition[1],this.filterOrgAndPosition(this.filterPickerObject.filterOrg,this.filterPickerObject.filterPosition)):(this.filterPickerObject.filterOrg=this.filterPickerObject.slots[0].values[0].name,this.filterPickerObject.filterPosition=this.filterPickerObject.slots[0].values[0].children[0],this.setStorageDecomposition([this.filterPickerObject.filterOrg,this.filterPickerObject.filterPosition])),this.setPickerDefaultIndex(this.storeStorageDecomposition)},filterOrgAndPosition:function(t,e){"同级人员"===t?(this.showSameLevelSubTask="全部显示"===e?this.sameLevelSubTask:v.default.filter(this.sameLevelSubTask,{positionName:e}),this.filterSubLevelSubTask=[],this.showSubLevelSubTask=[],this.noMore=!0,this.filterPickerObject.onFilterNone=0===this.showSameLevelSubTask.length):"下级人员"===t&&(this.filterSubLevelSubTask="全部显示"===e?this.subLevelSubTask:v.default.filter(this.subLevelSubTask,{positionName:e}),this.noMore=this.filterSubLevelSubTask.length<10,this.showSubLevelSubTask=this.filterSubLevelSubTask.slice(0,10),this.showSameLevelSubTask=[],this.filterPickerObject.onFilterNone=0===this.filterSubLevelSubTask.length)},setFilter:function(){this.filterPickerObject.popupVisible=!1;var t=this.$refs.filterPicker;this.filterPickerObject.filterOrg=t.getValues()[0].name,this.filterPickerObject.filterPosition=t.getValues()[1],this.setStorageDecomposition([this.filterPickerObject.filterOrg,this.filterPickerObject.filterPosition])},btnStart:function(){var t=window.event;t.target.style.background="#265C98",t.target.style.color="#6B8D9B"},btnEnd:function(){var t=window.event;t.target.style.background="#3396E4",t.target.style.color="#fff"},goToPageSub:function(t,e,s){this.$router.push({name:"Sub",query:{personId:t,same:e,taskId:s}})},resetTask:function(){var t=(0,c.default)(o.default.mark(function t(e){var s,a=this;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s={subPersonTaskId:e,personTaskId:this.detail.personTaskId},t.next=3,(0,k.loadData)(function(){return d.default.deleteSubTask(e)},function(){var t=(0,c.default)(o.default.mark(function t(e){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=6;break}return a.resetSubTask(s),t.next=4,(0,k.loadData)(function(){return a.resetSubPersonTask(a.detail.personTaskId)});case 4:a.getSubTasksDetail(),a.filterOrgAndPosition(a.filterPickerObject.filterOrg,a.filterPickerObject.filterPosition);case 6:case"end":return t.stop()}},t,a)}));return function(e){return t.apply(this,arguments)}}(),k.boolPreHandler);case 3:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),submit:function(t,e){var s=this,a=this;f.MessageBox.confirm("提交后任务不可修改，确定要提交吗？").then((0,c.default)(o.default.mark(function i(){return o.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,k.loadData)(function(){return d.default.submitSubTask(t)},function(){var i=(0,c.default)(o.default.mark(function i(n){var r;return o.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!n){s.next=6;break}return r={personTaskId:a.detail.personTaskId,same:e,subPersonTaskId:t},s.next=4,a.afterSubmit(r);case 4:a.getSubTasksDetail(),a.setStorageFilter();case 6:case"end":return s.stop()}},i,s)}));return function(t){return i.apply(this,arguments)}}(),k.boolPreHandler);case 2:case"end":return i.stop()}},i,s)})))},loadMore:function(){var t=this;this.noMore||(this.loading=!0,setTimeout(function(){var e,s=t.showSubLevelSubTask.length,a=s+10;t.noMore=t.filterSubLevelSubTask.slice(s,a).length<10,(e=t.showSubLevelSubTask).push.apply(e,(0,i.default)(t.filterSubLevelSubTask.slice(s,a))),t.loading=!1},1e3))}}),computed:(0,l.default)({},(0,u.mapState)("task",{storeStorageDecomposition:function(t){return t.storageDecomposition},storePersonTask:function(t){return t.taskList.personTask}})),watch:{"filterPickerObject.filterPosition":function(t){this.filterOrgAndPosition(this.filterPickerObject.filterOrg,t)},"filterPickerObject.filterOrg":function(t){this.filterOrgAndPosition(t,this.filterPickerObject.filterPosition)}}}}});
//# sourceMappingURL=19.97392abd0bc2a99ddedb.js.map