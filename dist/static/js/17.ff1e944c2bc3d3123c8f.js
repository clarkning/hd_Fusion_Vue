webpackJsonp([17],{BQXT:function(t,e,a){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var n=s(a("woOf")),r=s(a("pFYg")),i=s(a("mvHQ")),u=s(a("Dd8w")),o=s(a("Xxa5")),l=s(a("exGp")),d=s(a("3D1+")),c=a("NYxO"),f=a("Au9i"),p=s(a("M4fF")),m=a("JaHG");e.default={name:"Subtask",data:function(){return{taskId:null,same:!1,personTaskId:null,personName:"",personId:null,organizationName:"",taskItems:[],rewards:[],btn:!0}},created:function(){var t=(0,l.default)(o.default.mark(function t(){var e=this;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.same=Number(this.$route.query.same),this.taskId=Number(this.$route.query.taskId),this.personId=Number(this.$route.query.personId),t.next=5,(0,m.loadData)(function(){return e.initData()});case 5:this.getTaskDetail();case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),methods:(0,u.default)({},(0,c.mapActions)(["getOrganizationInfo","getSameInfo","getSubInfo"]),(0,c.mapActions)("task",["afterDistribute","getSubTask","getPersonTaskList","getDetail"]),{taskProgress:function(t){p.default.forEach(t.task.taskItems,function(e){var a=p.default.find(t.progress,{taskItemId:e.taskItemId}),s=parseInt(a.distribute||0);p.default.assign(e,{distribute:s})})},btnStart:function(){var t=window.event;t.target.style.background="#265C98",t.target.style.color="#6B8D9B"},btnEnd:function(){var t=window.event;t.target.style.background="#3396E4",t.target.style.color="#fff"},incomeRewardAllotValue:function(t,e){var a=0;return p.default.forEach(t,function(t){if(t.task){var s=t.task.reward,n=void 0,r=p.default.find(s,{taskIncomeObject:e});n=r?Number(r.incomeValue):0,a+=n}}),a},getTaskDetail:function(){var t=this,e=p.default.find(this.storePersonTask,{taskId:this.taskId}),a=JSON.parse((0,i.default)(e));this.taskProgress(a),this.personTaskId=a.personTaskId,this.taskItems=this.copyArr(a.task.taskItems);var s=this.copyArr(a.task.reward);if(this.rewards=p.default.filter(s,function(t){return"任务"!==t.taskIncomeObject}),p.default.forEach(this.rewards,function(e){var s=t.incomeRewardAllotValue(a.sameLevelSubTask,e.taskIncomeObject)+t.incomeRewardAllotValue(a.subLevelSubTask,e.taskIncomeObject),n={rewardAllotValue:s,rest:e.incomeValue-s};p.default.assign(e,n)}),1===this.same){var n=p.default.find(a.sameLevelSubTask,{personId:this.personId});this.personName=n.personName,this.organizationName=n.organizationNamePath,this.personId=n.personId}else{var r=p.default.find(a.subLevelSubTask,{personId:this.personId});this.personName=r.personName,this.organizationName=r.organizationNamePath,this.personId=r.personId}},initData:function(){var t=(0,l.default)(o.default.mark(function t(){var e,a,s,n,r,i;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getOrganizationInfo(this.$store.state.person.personId);case 2:if(!p.default.isEmpty(this.storePersonTask)){t.next=17;break}return e=1,a=this,s=function(){var t=(0,l.default)(o.default.mark(function t(){var n,r;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.getPersonTaskList(e);case 2:if(n=p.default.find(a.storePersonTask,{taskId:a.taskId})){t.next=9;break}return e++,t.next=7,s();case 7:t.next=12;break;case 9:return r={taskId:n.taskId,personTaskId:n.personTaskId},t.next=12,a.getDetail(r);case 12:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),t.next=8,s();case 8:return n=p.default.find(this.storePersonTask,{taskId:this.taskId}),r=p.default.find(this.$store.state.person.orgInfo,{partnerId:n.partnerId}).organizationId,t.next=12,this.getSameInfo(r);case 12:return t.next=14,this.getSubInfo(r);case 14:return i={subPersonTaskIds:n.subPersonTaskIds,partnerId:n.partnerId,taskId:this.taskId},t.next=17,this.getSubTask(i);case 17:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),copyArr:function(t){return t.map(function(t){return"object"===(void 0===t?"undefined":(0,r.default)(t))?(0,n.default)({inputValue:"",state:""},t):t})},noNull:function(){function t(t){return 0===Number(t.inputValue)}(this.rewards.length>0?this.taskItems.every(t)||this.rewards.every(t):this.taskItems.every(t))?(0,f.MessageBox)({title:"提示",message:"请分配至少一项任务（或奖励）"}):this.verification()},verification:function(){function t(t){return"error"===t.state}p.default.forEach(this.rewards,function(t){""===t.inputValue&&(t.inputValue="0"),t.inputValue=t.inputValue.replace(/\D/g,""),Number(t.inputValue)>Number(t.rest)||Number(t.inputValue)<0?t.state="error":t.state="success"}),p.default.forEach(this.taskItems,function(t){""===t.inputValue&&(t.inputValue="0"),t.inputValue=t.inputValue.replace(/\D/g,""),Number(t.inputValue)<0?t.state="error":t.state="success"});!this.taskItems.find(t)&&!this.rewards.find(t)&&this.prompt()},prompt:function(){var t=this,e='<div class="t-l">将为 '+this.personName+" 分配以下任务</div>",a='<div class="t-l weight">任务分配</div>',s='<div class="t-l weight">奖励分配</div>';p.default.forEach(this.taskItems,function(t){var e='<div class="t-l mg-left">'+t.name+"："+Number(t.inputValue)+"</div>";a+=e}),p.default.forEach(this.rewards,function(t){var e='<div class="t-l mg-left">'+t.taskIncomeObject+"："+Number(t.inputValue)+"</div>";s+=e});var n=void 0;n=this.rewards.length>0?e+a+s:e+a,f.MessageBox.confirm(n).then(function(){t.submit()})},submit:function(){var t=(0,l.default)(o.default.mark(function t(){var e,a,s,n,r=this;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.btn){t.next=2;break}return t.abrupt("return");case 2:return this.btn=!1,e=this,a=[],s=[],p.default.forEach(this.rewards,function(t){var e={taskIncomeObject:t.taskIncomeObject,incomeValue:Number(t.inputValue),taskImcomeCondition:t.taskImcomeCondition};a.push(e)}),p.default.forEach(this.taskItems,function(t){var e={taskItemId:t.taskItemId,targetType:t.targetType,target:Number(t.inputValue),rowNumber:t.rowNumber};s.push(e)}),n={personTaskId:this.personTaskId,personId:this.personId,taskIncomes:a,taskItems:s},t.next=11,(0,m.loadData)(function(){return d.default.postSubTask(n)},function(){var t=(0,l.default)(o.default.mark(function t(a){var s;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=5;break}return s={personTaskId:e.personTaskId,same:e.same},t.next=4,e.afterDistribute(s);case 4:e.$router.go(-1);case 5:case"end":return t.stop()}},t,r)}));return function(e){return t.apply(this,arguments)}}(),m.boolPreHandler);case 11:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}),computed:(0,u.default)({},(0,c.mapState)("task",{storePersonTask:function(t){return t.taskList.personTask}}))}},ThMl:function(t,e){},hIO0:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("BQXT"),n=a.n(s),r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"Subtask"},[a("div",{staticClass:"bg_img_none"},[a("mt-cell",[a("span",{staticClass:"organizeTitle",attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.personName))]),t._v(" "),a("span",{staticClass:"organizeValue"},[t._v(t._s(t.organizationName))])])],1),t._v(" "),a("div",{staticClass:"title bg_img_none"},[a("mt-cell",[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("任务")])])],1),t._v(" "),a("div",{staticClass:"bg_img_none"},t._l(t.taskItems,function(e){return a("div",{staticClass:"form mb"},[a("mt-cell",{attrs:{title:e.name}},[a("span",[t._v(t._s(e.distribute+(Number(e.inputValue)||0))+"/ "+t._s(e.target))]),t._v(" "),"销售量"===e.targetType?a("span",[t._v("单")]):a("span",[t._v("元")])]),t._v(" "),a("mt-field",{attrs:{placeholder:"请输入任务分配量，分配百分比可大于100%",type:"number",state:e.state},model:{value:e.inputValue,callback:function(a){t.$set(e,"inputValue",a)},expression:"task.inputValue"}})],1)})),t._v(" "),t.rewards.length>0?a("div",{staticClass:"title bg_img_none"},[a("mt-cell",[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("奖励")])])],1):t._e(),t._v(" "),a("div",{staticClass:"bg_img_none inputReward clear"},t._l(t.rewards,function(e){return a("div",{staticClass:"form mb"},[a("mt-field",{attrs:{label:e.taskIncomeObject,placeholder:"最多分配 "+e.rest,type:"number",state:e.state},model:{value:e.inputValue,callback:function(a){t.$set(e,"inputValue",a)},expression:"reward.inputValue"}}),t._v(" "),a("div",{staticClass:"displayNum"},[a("mt-cell",{attrs:{value:e.rewardAllotValue+(Number(e.inputValue)||0)+"/"+e.incomeValue}})],1)],1)})),t._v(" "),a("div",{staticClass:"mg",on:{touchstart:function(e){t.btnStart()},touchend:function(e){t.btnEnd()}}},[a("mt-button",{attrs:{type:"primary",size:"large"},on:{click:function(e){t.noNull()}}},[t._v("保存")])],1)])},staticRenderFns:[]},i=function(t){a("ThMl")},u=a("VU/8")(n.a,r,!1,i,"data-v-72a12038",null);e.default=u.exports}});
//# sourceMappingURL=17.ff1e944c2bc3d3123c8f.js.map