webpackJsonp([15],{"+F1A":function(t,e){},"3Fov":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("lPGv"),n=a.n(s),r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.detail.task.taskName?a("div",{staticClass:"TaskSchedule"},[a("div",{class:{fixed:t.fixed}},[a("p",{staticClass:"p"},[t._v("任务名称")]),t._v(" "),a("ul",{staticClass:"des"},[a("li",[t._v(t._s(t.detail.task.taskName))])]),t._v(" "),t.taskDetailDescription?a("p",{staticClass:"p"},[t._v("任务时间")]):t._e(),t._v(" "),a("ul",{staticClass:"des"},[t.detail.task.acceptEndTime&&!t.detail.task.acceptStartTime?a("li",[t._v("任务接受时间截止至"+t._s(t.detail.task.acceptEndTime))]):t._e(),t._v(" "),t.detail.task.acceptEndTime&&t.detail.task.acceptStartTime?a("li",[t._v(t._s(t.detail.task.acceptStartTime)+" ~ "+t._s(t.detail.task.acceptEndTime))]):t._e(),t._v(" "),!t.detail.task.acceptEndTime&&t.detail.task.acceptStartTime?a("li",[t._v("接受时间开始于："+t._s(t.detail.task.acceptStartTime))]):t._e(),t._v(" "),t.detail.finishDate&&!t.detail.startDate?a("li",[a("p",[t._v("任务截止至 "+t._s(t.detail.finishDate))])]):t._e(),t._v(" "),!t.detail.finishDate&&t.detail.startDate?a("li",[a("p",[t._v("任务开始于 "+t._s(t.detail.startDate))])]):t._e(),t._v(" "),t.detail.finishDate&&t.detail.startDate?a("li",[a("p",[t._v(t._s(t.detail.startDate)+" ~ "+t._s(t.detail.finishDate))])]):t._e()]),t._v(" "),t.detail.task.taskDescription?a("p",{staticClass:"p"},[t._v("任务描述")]):t._e(),t._v(" "),a("ul",{staticClass:"des"},[t.detail.task.taskDescription?a("li",{staticClass:"description",domProps:{innerHTML:t._s(t.detail.task.taskDescription)}}):t._e()]),t._v(" "),t.detail.task.taskItems.length>0?a("p",{staticClass:"p"},[t.detail.personTaskStatus?a("span",[t._v("任务进度")]):a("span",[t._v("任务要求")]),t._v(" "),t.detail.personTaskStatus?a("span",{staticClass:"f-r"},[t._v(t._s(t.detail.task.finishRate)+"%")]):t._e()]):t._e(),t._v(" "),a("div",{staticClass:"bg_img_none"},[t._l(t.detail.task.taskItems,function(e){return a("div",{key:e.id,staticClass:"container"},[a("mt-cell",{attrs:{title:e.name}},[t.detail.personTaskStatus?a("div",[a("span",[t._v(t._s(e.progress)+"/"+t._s(e.target))]),t._v(" "),"销售量"===e.targetType?a("span",[t._v("单")]):a("span",[t._v("元")])]):a("div",[a("span",[t._v(t._s(e.target))]),t._v(" "),"销售量"===e.targetType?a("span",[t._v("单")]):a("span",[t._v("元")])])]),t._v(" "),e.taskItemAttributes?a("div",t._l(e.taskItemAttributes,function(e){return a("div",{staticClass:"KeyWord"},[a("div",{staticClass:"TaskItemAttributeKeyWord",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.keyWord))]),t._v(" "),a("div",{staticClass:"Value"},[t._v(t._s(e.value))])])})):t._e()],1)}),t._v(" "),t.showSubTask?a("div",{on:{click:function(e){t.goToPageSubTaskDetail()}}},[a("mt-cell",{attrs:{title:"下级任务进度","is-link":""}})],1):t._e()],2),t._v(" "),t.detail.task.reward.length>0?a("p",{staticClass:"p"},[t._v("任务达成")]):t._e(),t._v(" "),a("ul",{staticClass:"reward"},[a("li",{staticClass:"taskList"},t._l(t.incomeRewards,function(e){return a("span",{staticClass:"t-l f-s-10",class:{database:"佣金"===e.taskIncomeObject,star:"经验"===e.taskIncomeObject,leaf:"积分"===e.taskIncomeObject}},[a("i",{staticClass:"fa",attrs:{"aria-hidden":"true"}}),t._v(" "),"佣金"===e.taskIncomeObject?a("span",[t._v("+"+t._s(e.incomeValue)+" 元")]):a("span",[t._v("+"+t._s(e.incomeValue)+"/"+t._s(e.taskIncomeObject))])])})),t._v(" "),t._l(t.incomeTask,function(e){return a("li",[a("span",{staticClass:"bars",on:{click:function(a){t.goToPageIncomeTask(e.incomeValue)}}},[a("i",{staticClass:"fa",attrs:{"aria-hidden":"true"}}),t._v(" "),a("span",[t._v(t._s(e.taskName))]),t._v(" "),a("span",[t._v("点击查看详情")])])])})],2),t._v(" "),t.detail.task.amerce.length>0?a("p",{staticClass:"p"},[t._v("任务失败")]):t._e(),t._v(" "),a("ul",{staticClass:"reward"},[a("li",{staticClass:"taskList"},t._l(t.amerceRewards,function(e){return a("span",{staticClass:"t-l f-s-10",class:{database:"佣金"===e.taskIncomeObject,star:"经验"===e.taskIncomeObject,leaf:"积分"===e.taskIncomeObject}},[a("i",{staticClass:"fa",attrs:{"aria-hidden":"true"}}),t._v(" "),"佣金"===e.taskIncomeObject?a("span",[t._v("-"+t._s(e.incomeValue)+" 元")]):a("span",[t._v("-"+t._s(e.incomeValue)+"/"+t._s(e.taskIncomeObject))])])})),t._v(" "),t._l(t.amerceTask,function(e){return a("li",[a("span",{staticClass:"bars",on:{click:function(a){t.goToPageIncomeTask(e.incomeValue)}}},[a("i",{staticClass:"fa",attrs:{"aria-hidden":"true"}}),t._v(" "),a("span",[t._v(t._s(e.taskName))]),t._v(" "),a("span",[t._v("点击查看详情")])])])}),t._v(" "),"已领取奖励"===t.detail.personTaskStatus?a("div",{staticClass:"Receive"}):t._e(),t._v(" "),"失败"===t.detail.personTaskStatus?a("div",{staticClass:"over"}):t._e()],2)]),t._v(" "),a("div",{staticClass:"mg",on:{touchstart:function(e){t.btnStart()},touchend:function(e){t.btnEnd()}}},["进行中"===t.detail.personTaskStatus&&"分解任务"===t.detail.task.taskType?a("mt-button",{attrs:{type:"primary",size:"large"},on:{click:function(e){t.goToPageDecompositionTask()}}},[t._v("分解任务")]):t._e(),t._v(" "),t.detail.personTaskStatus?t._e():a("mt-button",{attrs:{type:"primary",size:"large",disabled:!t.accept},on:{click:function(e){t.acceptableTask(t.detail.task.taskId)}}},[t._v("接受任务")]),t._v(" "),"达成"===t.detail.personTaskStatus?a("mt-button",{attrs:{type:"primary",size:"large"},on:{click:function(e){t.taskIncome(t.detail.personTaskId)}}},[t._v("领取奖励")]):t._e()],1),t._v(" "),"进行中"===t.detail.personTaskStatus&&"普通任务"===t.detail.task.taskType?a("div",{staticClass:"mg"},[a("mt-button",{attrs:{type:"default",size:"large",disabled:!0}},[t._v("领取奖励")])],1):t._e()]):t._e()},staticRenderFns:[]},i=function(t){a("+F1A")},c=a("VU/8")(n.a,r,!1,i,"data-v-2043adfa",null);e.default=c.exports},lPGv:function(t,e,a){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var n=s(a("woOf")),r=s(a("mvHQ")),i=s(a("BO1k")),c=s(a("Dd8w")),u=s(a("Xxa5")),o=s(a("exGp")),l=a("NYxO"),d=s(a("3D1+")),f=s(a("PJh5")),k=s(a("M4fF")),p=a("Au9i"),h=a("JaHG");e.default={name:"TaskSchedule",data:function(){return{fixed:!1,taskDetailDescription:!1,taskId:null,personTaskId:null,content:"",incomeRewards:[],incomeTask:[],amerceRewards:[],amerceTask:[],showSubTask:!1,accept:!0,detail:{task:{taskName:null,taskItems:[],amerce:[],reward:[]},personTaskStatus:null,progress:[]}}},created:function(){var t=(0,o.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.content=this.$route.query.content,"schedule"===this.content?this.personTaskId=Number(this.$route.query.personTaskId):this.taskId=Number(this.$route.query.taskId),t.next=4,this.initList();case 4:return t.next=6,this.getTaskDetail();case 6:return t.next=8,this.rewards();case 8:return t.next=10,this.amerces();case 10:return this.showDescription(),t.next=13,this.getSubTaskDetail();case 13:this.showSubTaskLink();case 14:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),methods:(0,c.default)({},(0,l.mapActions)(["getOrganizationInfo","getSameInfo","getSubInfo"]),(0,l.mapActions)("task",["rewardTask","afterTaskIncome","getTaskListAcceptable","getPersonTaskList","getHomePersonTaskList","getSubTask","getDetail"]),{toastMsg:function(t){(0,p.Toast)({message:t,position:"middle",duration:2e3})},fishRate:function(t,e){e.taskItems=k.default.filter(e.taskItems,function(t){return t.target>0});var a=0,s=1/e.taskItems.length,n=!0,r=!1,c=void 0;try{for(var u,o=(0,i.default)(e.taskItems);!(n=(u=o.next()).done);n=!0){var l=u.value;a+=s*((k.default.find(t.progress,{taskItemId:l.taskItemId}).progress||0)/l.target)*100}}catch(t){r=!0,c=t}finally{try{!n&&o.return&&o.return()}finally{if(r)throw c}}var d=k.default.find(t.progress,function(t){return"达成"!==t.status});a=a<100&&!d?100:a>0&&a<1?1:parseInt(a.toString()),k.default.assign(e,{finishRate:a})},showDescription:function(){var t=this.detail.task.acceptEndTime||this.detail.task.acceptStartTime,e=this.detail.finishDate||this.detail.startDate;this.taskDetailDescription=t||e,this.fixed=!this.detail.personTaskStatus||"进行中"===this.detail.personTaskStatus&&"分解任务"===this.detail.task.taskType||"达成"===this.detail.personTaskStatus},incomeData:function(t){var e=k.default.filter(t.taskIncomes,{taskImcomeCondition:"任务失败后"}),a=k.default.filter(t.taskIncomes,function(t){return"任务达成后"===t.taskImcomeCondition&&t.incomeValue>0});k.default.assign(t,{reward:a,amerce:e})},getTaskDetail:function(){var t=(0,o.default)(u.default.mark(function t(){var e,a,s,n=this;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("schedule"!==this.content){t.next=10;break}e=k.default.find(this.storePersonTask,{personTaskId:this.personTaskId}),a=JSON.parse((0,r.default)(e)),this.fishRate(a,a.task),k.default.forEach(a.task.taskItems,function(t){var e=k.default.find(a.progress,{taskItemId:t.taskItemId}),s={status:e.status,progress:e.progress||0};k.default.assign(t,s)}),this.detail=a,this.detail.finishDate=this.detail.finishDate?(0,f.default)(this.detail.finishDate).format("YYYY-MM-DD HH:mm"):null,this.detail.startDate=this.detail.startDate?(0,f.default)(this.detail.startDate).format("YYYY-MM-DD HH:mm"):null,t.next=20;break;case 10:if(this.accept=k.default.find(this.storeAcceptable,{taskId:this.taskId}),!this.accept){t.next=16;break}s=k.default.find(this.storeDetails,{taskId:this.taskId}),this.detail.task=JSON.parse((0,r.default)(s)),t.next=18;break;case 16:return t.next=18,(0,h.loadData)(function(){return d.default.getTaskDetail(n.taskId)},function(t){n.incomeData(t),n.detail.task=t},h.defaultPreHandler);case 18:this.detail.task.acceptEndTime=this.detail.task.acceptEndTime?(0,f.default)(this.detail.task.acceptEndTime).format("YYYY-MM-DD HH:mm"):null,this.detail.task.acceptStartTime=this.detail.task.acceptStartTime?(0,f.default)(this.detail.task.acceptStartTime).format("YYYY-MM-DD HH:mm"):null;case 20:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),goToPageSubTaskDetail:function(){this.$router.push({name:"SubTaskDetail",query:{personTaskId:this.personTaskId}})},showSubTaskLink:function(){if(this.detail.sameLevelSubTask){var t=k.default.find(this.detail.sameLevelSubTask,function(t){return t.taskStatus&&"新建"!==t.taskStatus}),e=k.default.find(this.detail.subLevelSubTask,function(t){return t.taskStatus&&"新建"!==t.taskStatus});this.showSubTask=t||e}},getSubTaskDetail:function(){var t=(0,o.default)(u.default.mark(function t(){var e,a,s=this;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!("分解任务"===this.detail.task.taskType&&this.detail.subPersonTaskIds.length>0)||this.detail.sameLevelSubTask){t.next=12;break}return t.next=3,(0,h.loadData)(function(){return s.getOrganizationInfo(s.$store.state.person.personId)});case 3:return e=k.default.find(this.$store.state.person.orgInfo,{partnerId:this.detail.partnerId}).organizationId,t.next=6,this.getSameInfo(e);case 6:return t.next=8,this.getSubInfo(e);case 8:return a={subPersonTaskIds:this.detail.subPersonTaskIds,partnerId:this.detail.partnerId,taskId:this.detail.taskId},t.next=11,this.getSubTask(a);case 11:this.getTaskDetail();case 12:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),rewards:function(){var t=(0,o.default)(u.default.mark(function t(){var e,a,s,r,c,o,l=this;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.detail.task.reward){t.next=29;break}if(this.incomeRewards=k.default.filter(this.detail.task.reward,function(t){return"任务"!==t.taskIncomeObject}),this.incomeTask=k.default.filter(this.detail.task.reward,{taskIncomeObject:"任务"}),!(this.incomeTask.length>0)){t.next=29;break}e=!0,a=!1,s=void 0,t.prev=7,r=u.default.mark(function t(){var e,a,s;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=o.value,a=k.default.find(l.storeRewardTask,function(t){var a=Number(e.incomeValue);return t.taskId===a}),s=void 0,a){t.next=8;break}return t.next=6,(0,h.loadData)(function(){return l.rewardTask(e.incomeValue)},function(t){s=t});case 6:t.next=9;break;case 8:s=a;case 9:(0,n.default)(e,{taskName:s.taskName});case 10:case"end":return t.stop()}},t,l)}),c=(0,i.default)(this.incomeTask);case 10:if(e=(o=c.next()).done){t.next=15;break}return t.delegateYield(r(),"t0",12);case 12:e=!0,t.next=10;break;case 15:t.next=21;break;case 17:t.prev=17,t.t1=t.catch(7),a=!0,s=t.t1;case 21:t.prev=21,t.prev=22,!e&&c.return&&c.return();case 24:if(t.prev=24,!a){t.next=27;break}throw s;case 27:return t.finish(24);case 28:return t.finish(21);case 29:case"end":return t.stop()}},t,this,[[7,17,21,29],[22,,24,28]])}));return function(){return t.apply(this,arguments)}}(),amerces:function(){var t=(0,o.default)(u.default.mark(function t(){var e,a,s,n,r,c,o=this;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.detail.task.amerce){t.next=29;break}if(this.amerceRewards=k.default.filter(this.detail.task.amerce,function(t){return"任务"!==t.taskIncomeObject}),this.amerceTask=k.default.filter(this.detail.task.amerce,{taskIncomeObject:"任务"}),!(this.amerceTask.length>0)){t.next=29;break}e=!0,a=!1,s=void 0,t.prev=7,n=u.default.mark(function t(){var e,a,s;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=c.value,a=k.default.find(o.storeRewardTask,function(t){var a=Number(e.incomeValue);return t.taskId===a}),s=void 0,a){t.next=8;break}return t.next=6,(0,h.loadData)(function(){return o.rewardTask(e.incomeValue)},function(t){s=t});case 6:t.next=9;break;case 8:s=a;case 9:k.default.assign(e,{taskName:s.taskName});case 10:case"end":return t.stop()}},t,o)}),r=(0,i.default)(this.amerceTask);case 10:if(e=(c=r.next()).done){t.next=15;break}return t.delegateYield(n(),"t0",12);case 12:e=!0,t.next=10;break;case 15:t.next=21;break;case 17:t.prev=17,t.t1=t.catch(7),a=!0,s=t.t1;case 21:t.prev=21,t.prev=22,!e&&r.return&&r.return();case 24:if(t.prev=24,!a){t.next=27;break}throw s;case 27:return t.finish(24);case 28:return t.finish(21);case 29:case"end":return t.stop()}},t,this,[[7,17,21,29],[22,,24,28]])}));return function(){return t.apply(this,arguments)}}(),btnStart:function(){if(this.accept){var t=window.event;t.target.style.background="#265C98",t.target.style.color="#6B8D9B"}},btnEnd:function(){if(this.accept){var t=window.event;t.target.style.background="#26a2ff",t.target.style.color="#fff"}},acceptableTask:function(){var t=(0,o.default)(u.default.mark(function t(e){var a=this;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,h.loadData)(function(){return d.default.postTask(e)},function(){var t=(0,o.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=7;break}return a.accept=!1,t.next=4,(0,h.loadData)(function(){return a.getTaskListAcceptable()});case 4:return t.next=6,(0,h.loadData)(function(){return a.getHomePersonTaskList(1)});case 6:a.toastMsg("请前往红包奖励-已接任务列表，查看任务进度");case 7:case"end":return t.stop()}},t,a)}));return function(e){return t.apply(this,arguments)}}(),h.boolPreHandler);case 2:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),goToPageDecompositionTask:function(){this.$router.push({name:"DecompositionTask",query:{partnerId:this.detail.partnerId,personTaskId:this.personTaskId}})},taskIncome:function(){var t=(0,o.default)(u.default.mark(function t(e){var a=this;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,h.loadData)(function(){return d.default.taskIncome(e)},function(){var t=(0,o.default)(u.default.mark(function t(s){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!s){t.next=10;break}if(!s){t.next=10;break}return t.next=4,(0,h.loadData)(function(){return a.afterTaskIncome(e)});case 4:if(a.toastMsg("领取成功"),a.getTaskDetail(),!(a.incomeTask.length>0)){t.next=10;break}return t.next=9,(0,h.loadData)(function(){return a.getHomePersonTaskList(1)});case 9:a.$router.go(-1);case 10:case"end":return t.stop()}},t,a)}));return function(e){return t.apply(this,arguments)}}(),h.boolPreHandler);case 2:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),initList:function(){var t=(0,o.default)(u.default.mark(function t(){var e,a,s,n,r,i=this;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this,"schedule"!==this.content){t.next=15;break}if(k.default.find(this.storePersonTask,{personTaskId:e.personTaskId})){t.next=10;break}return a=1,s=function(){var t=(0,o.default)(u.default.mark(function t(){var n,r;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,h.loadData)(function(){return e.getPersonTaskList(a)},null,null,!0);case 2:if(n=k.default.find(e.storePersonTask,{personTaskId:e.personTaskId})){t.next=9;break}return a++,t.next=7,s();case 7:t.next=12;break;case 9:return r={taskId:n.taskId,personTaskId:n.personTaskId},t.next=12,(0,h.loadData)(function(){return e.getDetail(r)});case 12:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),t.next=8,s();case 8:t.next=15;break;case 10:if((n=k.default.find(this.storePersonTask,{personTaskId:this.personTaskId})).task){t.next=15;break}return r={taskId:n.taskId,personTaskId:n.personTaskId},t.next=15,(0,h.loadData)(function(){return i.getDetail(r)});case 15:if("detail"!==this.content||0!==this.storeDetails.length){t.next=18;break}return t.next=18,(0,h.loadData)(function(){return i.getTaskListAcceptable()});case 18:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),goToPageIncomeTask:function(t){this.$router.push({name:"IncomeTask",query:{taskId:t}})}}),computed:(0,c.default)({},(0,l.mapState)("task",{storeRewardTask:function(t){return t.rewardTask},storeDetails:function(t){return t.taskList.details},storeAcceptable:function(t){return t.taskList.acceptable},storePersonTask:function(t){return t.taskList.personTask}}))}}});
//# sourceMappingURL=15.d0598e45980431856f05.js.map