webpackJsonp([4],{"1xsX":function(t,e){},"200y":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("7BpX"),a=n.n(r),i={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"banner"},[n("div",{staticClass:"turnplate"},[n("canvas",{staticClass:"item",attrs:{id:"wheelCanvas",width:"422px",height:"422px"}}),t._v(" "),n("img",{staticClass:"pointer",attrs:{id:"pointer",src:t.imgSrc},on:{"~click":function(e){t.startGame()}}})]),t._v(" "),n("img",{staticStyle:{display:"none"},attrs:{src:t.lightningImg,id:"shan-img"}}),t._v(" "),n("img",{staticStyle:{display:"none"},attrs:{src:t.sorryImg,id:"sorry-img"}}),t._v(" "),t.msgTips?n("div",{staticClass:"tips-center"},[n("h2",{staticClass:"tips-title"},[t._v("抽奖结果")]),t._v(" "),n("p",{staticClass:"tips-p"},[t._v(t._s(t.awardName.replace("未中奖","谢谢参与")))]),t._v(" "),n("button",{staticClass:"msgbox-confirm-btn",on:{click:function(e){t.goToPageMyOrder()}}},[t._v("确定")])]):t._e(),t._v(" "),t.msgTips?n("div",{staticClass:"tips-bg"}):t._e()])},staticRenderFns:[]},s=function(t){n("zV0n")},u=n("VU/8")(a.a,i,!1,s,"data-v-4e750156",null);e.default=u.exports},"5bkL":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("DKS6"),a=n.n(r),i={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"draw"},[n("img",{staticClass:"animated bounceIn img_2_2",attrs:{src:"/static/draw/img_2.png"},on:{click:function(t){t.preventDefault()}}}),t._v(" "),n("lottery-turntable",{staticClass:"lottery",attrs:{restaraunts:t.rests,colors:t.colors,exciteId:t.exciteId}}),t._v(" "),n("img",{staticClass:"bottom_shadow",attrs:{src:"/static/draw/bottom_shadow.png"},on:{click:function(t){t.preventDefault()}}}),t._v(" "),n("img",{staticClass:"animated zoomIn kePublic_back",attrs:{src:"/static/draw/back1.png"},on:{click:function(t){t.preventDefault()}}}),t._v(" "),0!==t.drawHistoryList.historyDtos.length?n("div",{staticClass:"draw-history-box"},[n("div",{staticClass:"draw-history-title"},[t._v("获奖名单")]),t._v(" "),n("div",{staticClass:"draw-history"},[n("ul",{staticClass:"draw-history-list"},t._l(t.drawHistoryList.historyDtos,function(e){return n("li",[n("span",[t._v(t._s(e.storeName)+" - "+t._s(e.salesName)+" - "+t._s(e.award))])])}))])]):t._e()],1)},staticRenderFns:[]},s=function(t){n("1xsX")},u=n("VU/8")(a.a,i,!1,s,"data-v-009330f0",null);e.default=u.exports},"7BpX":function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=r(n("Xxa5")),i=r(n("exGp")),s=r(n("9lmn")),u=r(n("3D1+")),o=n("Au9i"),l=n("JaHG"),c=r(n("M4fF"));e.default={components:{},props:{restaraunts:Array,colors:Array,exciteId:Number},data:function(){return{imgSrc:"/static/draw/turnplate-pointer.png",lightningImg:"/static/draw/1.png",sorryImg:"/static/draw/2.png",lottery:null,hotList:this.restaraunts,turnPlate:{outsideRadius:192,textRadius:145,insideRadius:68,startAngle:1.5*Math.PI},orderId:"",msgTips:!1,excitationId:this.exciteId,awardName:""}},created:function(){var t=(0,i.default)(a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.orderId=this.$route.query.orderId;case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),mounted:function(){var t=(0,i.default)(a.default.mark(function t(){var e=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.loadImg(function(){e.drawRouletteWheel()});case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),methods:{drawRouletteWheel:function(){var t=document.getElementById("wheelCanvas"),e=this.turnPlate;if(t.getContext){var n=Math.PI/(this.restaraunts.length/2),r=t.getContext("2d");r.clearRect(0,0,422,422),r.strokeStyle="#FFBE04",r.font="16px Microsoft YaHei";for(var a=0;a<this.restaraunts.length;a++){var i=e.startAngle+a*n;r.fillStyle=this.colors[a],r.beginPath(),r.arc(211,211,e.outsideRadius,i,i+n,!1),r.arc(211,211,e.insideRadius,i+n,i,!0),r.stroke(),r.fill(),r.save(),r.fillStyle="#E5302F";var s=this.restaraunts[a];if(r.translate(211+Math.cos(i+n/2)*e.textRadius,211+Math.sin(i+n/2)*e.textRadius),r.rotate(i+n/2+Math.PI/2),c.default.indexOf(s,"M")>0)for(var u=c.default.split(s,"M"),o=0;o<u.length;o++)r.font=0===o?"bold 20px Microsoft YaHei":"16px Microsoft YaHei",0===o?r.fillText(u[o]+"M",-r.measureText(u[o]+"M").width/2,17*o):r.fillText(u[o],-r.measureText(u[o]).width/2,17*o);else if(-1===c.default.indexOf(s,"M")&&s.length>6){s=s.substring(0,6)+"||"+s.substring(6);for(var l=c.default.split(s,"||"),d=0;d<l.length;d++)r.fillText(l[d],-r.measureText(l[d]).width/2,17*d)}else r.fillText(s,-r.measureText(s).width/2,0);r.restore()}}},getDraw:function(){var t=(0,i.default)(a.default.mark(function t(){var e,n=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e={orderId:this.orderId,excitationId:this.exciteId},t.next=3,(0,l.loadData)(function(){return u.default.postDraw(e)},function(t){n.awardName=t.awardName},l.defaultPreHandler,!0);case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),prepareLottery:function(){var t=(0,i.default)(a.default.mark(function t(){var e,n,r=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=new s.default(document.getElementById("wheelCanvas"),{speed:30,areaNumber:this.restaraunts.length}),n=this,e.on("start",function(){var t=c.default.indexOf(n.restaraunts,n.awardName);t>=0?e.setResult(n.restaraunts.length-1-t):e.setResult(n.restaraunts.length-1)}),e.on("end",function(){r.msgTips=!0}),e.draw();case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),goToPageMyOrder:function(){this.$router.go(-1)},startGame:function(){var t=(0,i.default)(a.default.mark(function t(){var e=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,l.loadData)(function(){return u.default.getDraw(e.orderId)},function(){var t=(0,i.default)(a.default.mark(function t(n){var r;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=7;break}return r=e,t.next=4,e.getDraw().catch(function(t){"RequestTimeoutError"===t.name&&o.MessageBox.confirm("当前网络较弱，是否重新抽奖?").then((0,i.default)(a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.startGame();case 2:case"end":return t.stop()}},t,e)})))});case 4:if(!e.awardName){t.next=7;break}return t.next=7,r.prepareLottery();case 7:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}(),l.defaultPreHandler,!0);case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),loadImg:function(t){for(var e=0,n=[document.getElementById("shan-img"),document.getElementById("sorry-img")],r=0,a=n.length;r<a;r++)!function(r){r.onload=function(){++e===n.length&&t&&t()}}(n[r])}},watch:{hotList:function(){this.drawRouletteWheel()}}}},"7NfX":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){function r(t){return t.replace(/-([a-z])/gi,function(t,e){return e.toUpperCase()})}if(void 0===t.style[e])for(var a=["webkit","ms","moz","o",null],i=0;i<a.length;i++){var s=a[i];if(!s)return null;if(e=r(s+"-"+e),void 0!==t.style[e])break}return n&&(t.style[e]=n),e}},"7WXU":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=0;e.requestAnimationFrame=window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||function(t){var e=(new Date).getTime(),n=Math.max(0,16-(e-r)),a=window.setTimeout(function(){t(e+n)},n);return r=e+n,a},e.cancelAnimationFrame=window.cancelAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||function(t){clearInterval(t)}},"9lmn":function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=r(n("woOf")),i=r(n("Zx67")),s=r(n("Zrlr")),u=r(n("wxAW")),o=r(n("zwoO")),l=r(n("Pf15"));n("nlTz");var c=r(n("k+Iu")),d=r(n("7NfX")),f=n("7WXU"),h=function(t){function e(t,n){(0,s.default)(this,e);var r=(0,o.default)(this,(e.__proto__||(0,i.default)(e)).call(this));return r.options=(0,a.default)({speed:30,deviation:5},n),r.pointer=t,r.init(),r}return(0,l.default)(e,t),(0,u.default)(e,[{key:"init",value:function(){this._transform=(0,d.default)(this.pointer,"transform","translate3d(0,0,0)"),(0,d.default)(this.pointer,"backfaceVisibility","hidden"),(0,d.default)(this.pointer,"perspective","1000px"),this._raf=null,this._runAngle=0,this._targetAngle=-1}},{key:"reset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"reset";this._raf&&((0,f.cancelAnimationFrame)(this._raf),this._raf=null,this._runAngle=0,this._targetAngle=-1,this.trigger(t),"reset"===t&&(0,d.default)(this.pointer,this._transform,"translate3d(0,0,0) rotate(0deg)"))}},{key:"setResult",value:function(t){var e=360/this.options.areaNumber,n=Math.random()*e;n=Math.max(this.options.deviation,n),n=Math.min(e-this.options.deviation,n),n=Math.ceil(n+t*e),this._runAngle=0,this._targetAngle=n+360*(Math.floor(4*Math.random())+4)}},{key:"step",value:function(){var t=this;-1===this._targetAngle?this._runAngle+=this.options.speed:(this._angle=(this._targetAngle-this._runAngle)/this.options.speed,this._angle=this._angle>this.options.speed?this.options.speed:this._angle<.5?.5:this._angle,this._runAngle+=this._angle,this._runAngle=this._runAngle>this._targetAngle?this._targetAngle:this._runAngle),(0,d.default)(this.pointer,this._transform,"translate3d(0,0,0) rotate("+this._runAngle%360+"deg)"),this._runAngle===this._targetAngle?this.reset("end"):this._raf=(0,f.requestAnimationFrame)(function(){return t.step()})}},{key:"draw",value:function(){var t=this;this._raf||(this.has("start")&&this.trigger("start"),this._angle=0,this._raf=(0,f.requestAnimationFrame)(function(){return t.step()}))}}]),e}(c.default);e.default=h},DKS6:function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=r(n("Xxa5")),i=r(n("exGp")),s=r(n("200y")),u=r(n("3D1+")),o=r(n("M4fF")),l=n("JaHG");e.default={name:"Draw",components:{LotteryTurntable:s.default},data:function(){return{rests:["谢谢参与"],colors:["#fff"],animate:!1,drawHistoryList:{historyDtos:""},orderId:null,exciteId:null}},created:function(){var t=(0,i.default)(a.default.mark(function t(){var e,n=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this,this.orderId=this.$route.query.orderId,t.next=4,(0,l.loadData)(function(){return u.default.getExcitation(n.orderId)},function(t){o.default.forEach(t.prizeDtos,function(t){switch(e.rests.push(t.awardName.slice(0,11)),e.rests.length%2){case 0:e.colors.push("#fefef0");break;case 1:e.colors.push("#f2fefb")}}),n.exciteId=t.excitationId},l.defaultPreHandler,!0);case 4:return t.next=6,(0,l.loadData)(function(){return u.default.getDrawHistory(n.exciteId)},function(t){n.drawHistoryList=t},l.defaultPreHandler,!0);case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}},"k+Iu":function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=r(n("Zrlr")),i=r(n("wxAW")),s=function(){function t(){(0,a.default)(this,t),this._queue=[]}return(0,i.default)(t,[{key:"on",value:function(t,e){return this._queue[t]=this._queue[t]||[],this._queue[t].push(e),this}},{key:"off",value:function(t,e){if(this._queue[t]){var n=void 0===e?-2:this._queue[t].indexOf(e);-2===n?delete this._queue[t]:-1!==n&&this._queue[t].splice(n,1),this._queue[t]&&0===this._queue[t].length&&delete this._queue[t]}return this}},{key:"has",value:function(t){return!!this._queue[t]}},{key:"trigger",value:function(t){for(var e=this,n=arguments.length,r=Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return this._queue[t]&&this._queue[t].forEach(function(t){return t.apply(e,r)}),this}}]),t}();e.default=s},nlTz:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){return t&&t.__esModule?t:{default:t}}(n("woOf"));Object.assign=r.default||function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var a in r)r.hasOwnProperty(a)&&(e[a]=r[a])}return e},e.default=r.default},zV0n:function(t,e){}});
//# sourceMappingURL=4.b40ca6b3ef209fea888e.js.map